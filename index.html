<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lower River Region — Governor Portal (Government Multi-Page Prototype)</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    :root{--gold:#d4af37;--silver:#c0c0c0;--diamond:#b9f2ff;--lightgreen:#b7e4c7;--darkgray:#2f3437;--bg: linear-gradient(180deg, rgba(212,175,55,0.04), rgba(185,242,255,0.02));font-family:Inter, system-ui, -apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--darkgray)}
    header{background:linear-gradient(90deg,var(--gold),var(--silver));padding:14px 18px;color:#111;display:flex;align-items:center;gap:12px}
    header h1{font-size:18px;margin:0}
    .top-actions{margin-left:auto;display:flex;gap:8px}
    .container{display:grid;grid-template-columns:260px 1fr;min-height:calc(100vh - 64px)}
    aside{background:#fff;padding:14px;border-right:1px solid #eee}
    nav a{display:block;padding:8px;border-radius:8px;color:var(--darkgray);text-decoration:none;margin-bottom:4px}
    nav a.active{background:linear-gradient(90deg,var(--diamond),#fff);font-weight:600}
    main{padding:18px}
    .card{background:#fff;padding:12px;border-radius:12px;margin-bottom:12px;box-shadow:0 8px 24px rgba(47,52,55,0.04)}
    #map{height:380px;border-radius:10px}
    table{width:100%;border-collapse:collapse}
    table th,table td{padding:8px;border-bottom:1px solid #eee;text-align:left}
    .kpis{display:flex;gap:12px;margin-bottom:12px}
    .kpi{flex:1;padding:12px;border-radius:8px;background:linear-gradient(180deg,var(--lightgreen),#fff)}
    .btn{padding:8px 12px;border-radius:8px;border:none;background:var(--gold);cursor:pointer}
    .btn.secondary{background:var(--silver)}
    .muted{color:#666;font-size:13px}
    .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .small{font-size:13px;color:#666}
    footer{padding:10px;text-align:center;color:#666}
    @media(max-width:900px){.container{grid-template-columns:1fr}aside{position:relative}}
  </style>
</head>
<body>
  <header>
    <img src="" alt="LRR" style="width:44px;height:44px;background:var(--darkgray);border-radius:8px;" />
    <h1>Lower River Region — Governor Portal (Prototype)</h1>
    <div class="top-actions">
      <button class="btn" id="exportZip">Export all CSVs (ZIP)</button>
      <button class="btn secondary" id="helpBtn">Guide</button>
    </div>
  </header>  <div class="container">
    <aside>
      <nav>
        <a href="#" data-page="home" class="navlink active">Home Dashboard</a>
        <a href="#" data-page="districts" class="navlink">Districts</a>
        <a href="#" data-page="villages" class="navlink">Villages (All)</a>
        <a href="#" data-page="agriculture" class="navlink">Agriculture</a>
        <a href="#" data-page="health" class="navlink">Health</a>
        <a href="#" data-page="education" class="navlink">Education</a>
        <a href="#" data-page="infrastructure" class="navlink">Infrastructure</a>
        <a href="#" data-page="security" class="navlink">Security</a>
        <a href="#" data-page="disaster" class="navlink">Disaster Management</a>
        <a href="#" data-page="finance" class="navlink">Finance & Budget</a>
        <a href="#" data-page="staff" class="navlink">Staff Directory</a>
        <a href="#" data-page="ngos" class="navlink">NGO & Partners</a>
        <a href="#" data-page="reports" class="navlink">Monthly Reports</a>
      </nav>
      <hr />
      <div class="small">Colors: gold, silver, diamond, light green, dark gray. All data downloadable per-section as CSV. Editable inline and via forms.</div>
    </aside><main id="app">
  <!-- content rendered by JS -->
</main>

  </div>  <footer>Prototype — Verify and replace sample data with official records for production. Built for the Governor of Lower River Region.</footer>  <!-- libs -->  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>  <script>
    // ---------------------- Sample data (comprehensive) ----------------------
    const districts = ["Kiang West","Kiang Central","Kiang East","Jarra West","Jarra Central","Jarra East"];

    // Villages with expanded fields (households, lat/lon, amenities)
    const villages = [
      {district:"Kiang West",village:"Keneba",lat:13.320,lon:-15.440,pop:1775,households:320,chief:"Chief Yoro Jatta",alkalo:"Sidi Jatta",water_points:2,primary_school:true,health_post:true,council:"Kiang West Council"},
      {district:"Kiang West",village:"Manduar",lat:13.300,lon:-15.400,pop:820,households:150,chief:"Chief Kemo Ceesay",alkalo:"Musa Ceesay",water_points:1,primary_school:true,health_post:false,council:"Kiang West Council"},
      {district:"Kiang West",village:"Kantong Kunda",lat:13.310,lon:-15.460,pop:540,households:90,chief:"Chief Lamin",alkalo:"Samba",water_points:1,primary_school:false,health_post:false,council:"Kiang West Council"},
      {district:"Kiang West",village:"Jali",lat:13.305,lon:-15.435,pop:360,households:50,chief:"Chief Darboe",alkalo:"Pa N",water_points:1,primary_school:false,health_post:false,council:"Kiang West Council"},

      {district:"Kiang Central",village:"Tendaba",lat:13.250,lon:-15.350,pop:1200,households:240,chief:"Chief Bah",alkalo:"Jobe",water_points:3,primary_school:true,health_post:true,council:"Kiang Central Council"},
      {district:"Kiang Central",village:"Kwinella",lat:13.220,lon:-15.360,pop:680,households:120,chief:"Chief Saho",alkalo:"Jatta",water_points:1,primary_school:true,health_post:false,council:"Kiang Central Council"},
      {district:"Kiang Central",village:"Nema",lat:13.210,lon:-15.340,pop:410,households:70,chief:"Chief Colley",alkalo:"Fofana",water_points:1,primary_school:false,health_post:false,council:"Kiang Central Council"},

      {district:"Kiang East",village:"Laibe Kunda",lat:13.360,lon:-15.280,pop:430,households:76,chief:"Chief Colley",alkalo:"Sanyang",water_points:1,primary_school:false,health_post:false,council:"Kiang East Council"},
      {district:"Kiang East",village:"Yoro Jula",lat:13.340,lon:-15.300,pop:560,households:98,chief:"Chief Njie",alkalo:"Samba",water_points:2,primary_school:true,health_post:false,council:"Kiang East Council"},

      {district:"Jarra West",village:"Bureng",lat:13.250,lon:-15.220,pop:1491,households:260,chief:"Chief Jarju",alkalo:"Manneh",water_points:4,primary_school:true,health_post:true,council:"Jarra West Council"},
      {district:"Jarra West",village:"Pakaliba",lat:13.270,lon:-15.200,pop:1026,households:190,chief:"Chief Darboe",alkalo:"Ceesay",water_points:2,primary_school:true,health_post:false,council:"Jarra West Council"},
      {district:"Jarra West",village:"Jenoi",lat:13.260,lon:-15.210,pop:560,households:95,chief:"Chief Faal",alkalo:"Faal",water_points:1,primary_school:false,health_post:false,council:"Jarra West Council"},

      {district:"Jarra Central",village:"Soma",lat:13.460,lon:-15.240,pop:9869,households:1800,chief:"Chief Sanyang",alkalo:"Faye",water_points:12,primary_school:true,health_post:true,council:"Jarra Central Council"},
      {district:"Jarra Central",village:"Mansakonko",lat:13.450,lon:-15.300,pop:4200,households:720,chief:"Chief Njie",alkalo:"Bojang",water_points:8,primary_school:true,health_post:true,council:"Jarra Central Council"},
      {district:"Jarra Central",village:"Baro Kunda",lat:13.420,lon:-15.260,pop:1991,households:360,chief:"Chief Jatta",alkalo:"Jatta",water_points:3,primary_school:true,health_post:false,council:"Jarra Central Council"},

      {district:"Jarra East",village:"Jappineh Marikoto",lat:13.400,lon:-15.180,pop:1186,households:210,chief:"Chief Marenah",alkalo:"Jallow",water_points:2,primary_school:true,health_post:false,council:"Jarra East Council"},
      {district:"Jarra East",village:"Wellingara Ba",lat:13.380,lon:-15.160,pop:1464,households:270,chief:"Chief Cham",alkalo:"Kanteh",water_points:3,primary_school:true,health_post:true,council:"Jarra East Council"},
      {district:"Jarra East",village:"Jarra Sukuta",lat:13.392,lon:-15.170,pop:556,households:95,chief:"Chief Suso",alkalo:"Suso",water_points:1,primary_school:false,health_post:false,council:"Jarra East Council"},
      {district:"Jarra East",village:"Jappineh Tembeto",lat:13.392,lon:-15.185,pop:706,households:120,chief:"Chief Tembeto",alkalo:"Tembeto",water_points:1,primary_school:false,health_post:false,council:"Jarra East Council"}
    ];

    // Agriculture table with detailed columns
    let agriculture = [
      {id:1,village:"Keneba",season:"2025-main",crop:"Onion",hectares:2,estimate_yield_kg:4800,farmers:24,irrigation:"Solar-drip",extension_officer:"Agro. Sawo",inputs_provided: true},
      {id:2,village:"Manduar",season:"2025-main",crop:"Pepper",hectares:1.2,estimate_yield_kg:1500,farmers:10,irrigation:"Rainfed",extension_officer:"Agro. Ceesay",inputs_provided:false},
      {id:3,village:"Bureng",season:"2025-main",crop:"Rice",hectares:3,estimate_yield_kg:7200,farmers:40,irrigation:"Floodplain",extension_officer:"Agro. Jarju",inputs_provided:true}
    ];

    // Health table with facility type, staff, services
    let health = [
      {id:1,facility:"Keneba Health Post",village:"Keneba",type:"Health Post",staff:4,monthly_patients:210,services:["Immunization","OPD"],in_charge:"Nurse Mariama"},
      {id:2,facility:"Bureng Clinic",village:"Bureng",type:"Clinic",staff:6,monthly_patients:420,services:["Maternity","OPD","Malaria Test"],in_charge:"Dr. Bah"}
    ];

    // Education table with levels, enrollment, infrastructure
    let education = [
      {id:1,school:"Keneba Basic School",village:"Keneba",level:"Primary",teachers:6,students:320,has_library:false,lat:13.321,lon:-15.441,head_teacher:"Mr. Sanyang"},
      {id:2,school:"Soma Secondary",village:"Soma",level:"Secondary",teachers:18,students:1200,has_library:true,lat:13.461,lon:-15.241,head_teacher:"Mrs. Jatta"}
    ];

    // Infrastructure projects table with donor, status, timeline
    let infrastructure = [
      {id:1,project:"Tendaba Borehole",village:"Tendaba",type:"Water",status:"Operational",budget:2500,donor:"District Fund",start_date:"2024-08-01",completion_date:"2024-10-15"},
      {id:2,project:"Mansakonko-Main Road Rehab",village:"Mansakonko",type:"Road",status:"Ongoing",budget:15000,donor:"Ministry of Works",start_date:"2025-02-12",completion_date:"2025-11-30"}
    ];

    // Security reports table
    let security = [
      {id:1,village:"Soma",month:"2025-10",incidents:4,category:"Theft/Market Disturbance",response_actions:["Police patrol increased"],notes:"Market skirmishes during harvest"},
      {id:2,village:"Bureng",month:"2025-09",incidents:1,category:"Theft",response_actions:["Arrest made"],notes:"Minor incident"}
    ];

    // Disaster events
    let disasters = [
      {id:1,village:"Kantong Kunda",type:"Flood",date:"2025-07-12",impact_households:18,impact_notes:"Minor crop loss",ndma_reported:true},
      {id:2,village:"Laibe Kunda",type:"Windstorm",date:"2025-03-02",impact_households:7,impact_notes:"Roof damage",ndma_reported:false}
    ];

    // Finance & Budget table (council-level & projects)
    let finance = [
      {id:1,entity:"Kiang West Council",year:2025,revenue_gmd:250000,expenditure_gmd:180000,projects_funded:["Borehole Tendaba","Market Stalls"],notes:"Operational budget"},
      {id:2,entity:"Jarra Central Council",year:2025,revenue_gmd:420000,expenditure_gmd:320000,projects_funded:["Road Rehab"],notes:"Major donor grant pending"}
    ];

    // Staff directory (government & district officers)
    let staff = [
      {id:1,name:"Governor (Sample)",role:"Regional Governor",contact_phone:"+220 3000000",email:"governor@lrr.gov.gm",office:"Regional Office, Soma"},
      {id:2,name:"Agro. Sawo",role:"Regional Agriculture Officer",contact_phone:"+220 3000001",email:"agro@lrr.gov.gm",office:"Mansakonko"}
    ];

    // NGOs & Partners
    let ngos = [
      {id:1,name:"Farmers Cooperative Initiative",focus:"Agriculture",contact:"Fatou N.",projects:["Seed distribution"],active:true},
      {id:2,name:"Water For All",focus:"WASH",contact:"Ali B.",projects:["Borehole installs"],active:true}
    ];

    // Monthly reports (sample)
    let reports = [
      {id:1,month:"2025-01",title:"January Regional Report",author:"Regional Office",summary:"Overview of activities: planting season started, 3 boreholes drilled.",attachments:[]},
      {id:2,month:"2025-02",title:"February Health Summary",author:"Health Dept.",summary:"No major outbreaks; immunization campaign ongoing.",attachments:[]}
    ];

    // ---------------------- Utilities ----------------------
    function toCSV(arr, columns){ if(!arr||!arr.length)return ''; const cols = columns||Object.keys(arr[0]); const lines=[cols.join(',')]; arr.forEach(row=>lines.push(cols.map(c=>('"'+(row[c]===undefined?'':String(row[c]).replace(/"/g,'""'))+'"')).join(','))); return lines.join('
'); }
    function download(filename,content){ const blob=new Blob([content],{type:'text/csv;charset=utf-8;'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=filename; a.click(); }

    // ---------------------- Routing & render functions ----------------------
    const app = document.getElementById('app');
    function setActiveNav(page){ document.querySelectorAll('.navlink').forEach(a=>a.classList.toggle('active', a.getAttribute('data-page')===page)); }

    function renderHome(){ setActiveNav('home'); app.innerHTML = `
      <div class="card">
        <div class="kpis">
          <div class="kpi"><strong>${villages.length}</strong><div class="small">Total villages</div></div>
          <div class="kpi"><strong>${villages.reduce((s,v)=>s+v.pop,0)}</strong><div class="small">Estimated population</div></div>
          <div class="kpi"><strong>${education.reduce((s,e)=>s+e.students,0)}</strong><div class="small">Total students</div></div>
        </div>
        <div id="map" style="height:380px"></div>
      </div>
      <div class="card"><h3>Latest Alerts & Incidents</h3><div id="alerts">${security.slice(-3).map(s=>`<div><strong>${s.village} (${s.month})</strong> — ${s.category||'Incident'}: ${s.incidents} incidents</div>`).join('')}</div></div>
      <div class="card"><h3>Quick Exports</h3><div class="small">Download CSV for each sector:</div><div style="margin-top:8px">${makeExportButtonsHTML()}</div></div>
    `; initMap(); }

    function makeExportButtonsHTML(){ const parts=['villages','agriculture','health','education','infrastructure','security','disasters','finance','staff','ngos','reports']; return parts.map(p=>`<button class="btn" onclick="downloadSection('${p}')">${p}.csv</button>`).join(' '); }

    function renderListPage(title,arr,cols,section){ setActiveNav(section); let rows = arr.map(r=>`<tr>${cols.map(c=>`<td>${Array.isArray(r[c])?JSON.stringify(r[c]):(r[c]===undefined?'':r[c])}</td>`).join('')}<td><button class=\"btn secondary\" onclick=\"editRecord('${section}',${r.id||JSON.stringify(r.village)})\">Edit</button></td></tr>`).join(''); app.innerHTML = `<div class="card"><h2>${title}</h2><div class="small">Records: ${arr.length}</div><table><thead><tr>${cols.map(c=>`<th>${c}</th>`).join('')}<th>Actions</th></tr></thead><tbody>${rows}</tbody></table></div>`; }

    function renderDistricts(){ setActiveNav('districts'); app.innerHTML = `<div class="card"><h2>Districts Overview</h2><div class="small">Click a district to view detailed page.</div><div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px">${districts.map(d=>`<div class="card"><h3>${d}</h3><div class="small">Villages: ${villages.filter(v=>v.district===d).length}</div><div class="small">Population: ${villages.filter(v=>v.district===d).reduce((s,v)=>s+v.pop,0)}</div><div style="margin-top:8px"><button class=\"btn\" onclick=\"renderDistrict('${d}')\">Open</button></div></div>`).join('')}</div></div>`; }

    function renderDistrict(name){ setActiveNav('districts'); const vs = villages.filter(v=>v.district===name); const ag = agriculture.filter(a=>vs.some(v=>v.village===a.village)); const hs = health.filter(h=>vs.some(v=>v.village===h.village)); app.innerHTML = `<div class="card"><button class="btn secondary" onclick="renderDistricts()">Back</button><h2>${name} — District Page</h2><div class="small">Villages: ${vs.length} • Population: ${vs.reduce((s,v)=>s+v.pop,0)}</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px">
        <div class="card"><h4>Villages</h4><ul>${vs.map(v=>`<li>${v.village} — Pop ${v.pop} <button class=\"btn secondary\" onclick=\"renderVillage('${v.village}')\">Open</button></li>`).join('')}</ul></div>
        <div class="card"><h4>Key Indicators</h4><div class="small">Projects: ${infrastructure.filter(p=>vs.some(v=>v.village===p.village)).length} • Health facilities: ${hs.length} • Agriculture records: ${ag.length}</div></div>
      </div>
      <div style="margin-top:12px" class="card"><h4>District Projects & Finance</h4><div class="small">Finance records:</div><ul>${finance.filter(f=>f.entity.includes(name.split(' ')[0])||f.entity.includes(name.split(' ')[1])?`<li>${JSON.stringify(f)}</li>`:'').join('')||'<li>No council finance record shown — use Finance page.</li>'}</ul></div>
    </div>`; initDistrictMap(name); }

    function renderVillage(name){ setActiveNav('villages'); const v = villages.find(x=>x.village===name); const ag = agriculture.filter(a=>a.village===name); const hs = health.filter(h=>h.village===name); const ed = education.filter(e=>e.village===name); const infra = infrastructure.filter(i=>i.village===name); app.innerHTML = `<div class="card"><button class="btn secondary" onclick="renderDistrict('${v.district}')">Back</button><h2>${v.village} — Village Profile</h2>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px">
        <div class="card"><h4>Administrative</h4><table><tr><th>District</th><td>${v.district}</td></tr><tr><th>Population</th><td>${v.pop}</td></tr><tr><th>Households</th><td>${v.households}</td></tr><tr><th>Chief</th><td>${v.chief}</td></tr><tr><th>Alkalo</th><td>${v.alkalo}</td></tr><tr><th>Water points</th><td>${v.water_points}</td></tr></table></div>
        <div class="card"><h4>Services</h4><div class="small">Primary school: ${v.primary_school? 'Yes':'No'}</div><div class="small">Health post: ${v.health_post? 'Yes':'No'}</div><div style="margin-top:8px"><button class="btn" onclick="downloadSingleVillage('${name}')">Download village CSV</button></div></div>
      </div>
      <div style="margin-top:12px" class="card"><h4>Agriculture Records</h4>${ag.length?renderTableHTML(ag,['id','season','crop','hectares','estimate_yield_kg','farmers','irrigation','extension_officer','inputs_provided']):'<div class="small">No agriculture records</div>'}</div>
      <div style="margin-top:12px" class="card"><h4>Health Facilities</h4>${hs.length?renderTableHTML(hs,['id','facility','type','staff','monthly_patients','services','in_charge']):'<div class="small">No health records</div>'}</div>
      <div style="margin-top:12px" class="card"><h4>Education</h4>${ed.length?renderTableHTML(ed,['id','school','level','teachers','students','has_library','head_teacher']):'<div class="small">No education records</div>'}</div>
      <div style="margin-top:12px" class="card"><h4>Infrastructure</h4>${infra.length?renderTableHTML(infra,['id','project','type','status','budget','donor','start_date','completion_date']):'<div class="small">No infrastructure projects'}</div>
    </div>`; initSingleVillageMap(v); }

    function renderTableHTML(arr,cols){ return `<table><thead><tr>${cols.map(c=>`<th>${c}</th>`).join('')}<th>Actions</th></tr></thead><tbody>${arr.map(r=>`<tr>${cols.map(c=>`<td>${Array.isArray(r[c])?JSON.stringify(r[c]):(r[c]===undefined?'':r[c])}</td>`).join('')}<td><button class="btn secondary" onclick="editRecordInline(${r.id||'null'},'${cols.join(',')}')">Edit</button></td></tr>`).join('')}</tbody></table>` }

    function renderSectionList(section){ switch(section){
      case 'villages': renderListPage('All Villages',villages,['village','district','pop','households','chief','alkalo','water_points','primary_school','health_post'],'villages'); break;
      case 'agriculture': renderListPage('Agriculture',agriculture,['id','village','season','crop','hectares','estimate_yield_kg','farmers','irrigation','extension_officer','inputs_provided'],'agriculture'); break;
      case 'health': renderListPage('Health Facilities',health,['id','facility','village','type','staff','monthly_patients','services','in_charge'],'health'); break;
      case 'education': renderListPage('Education',education,['id','school','village','level','teachers','students','has_library','head_teacher'],'education'); break;
      case 'infrastructure': renderListPage('Infrastructure',infrastructure,['id','project','village','type','status','budget','donor','start_date','completion_date'],'infrastructure'); break;
      case 'security': renderListPage('Security Reports',security,['id','village','month','incidents','category','notes'],'security'); break;
      case 'disaster': renderListPage('Disasters',disasters,['id','village','type','date','impact_households','impact_notes','ndma_reported'],'disaster'); break;
      case 'finance': renderListPage('Finance & Budget',finance,['id','entity','year','revenue_gmd','expenditure_gmd','projects_funded','notes'],'finance'); break;
      case 'staff': renderListPage('Staff Directory',staff,['id','name','role','contact_phone','email','office'],'staff'); break;
      case 'ngos': renderListPage('NGO & Partners',ngos,['id','name','focus','contact','projects','active'],'ngos'); break;
      case 'reports': renderListPage('Monthly Reports',reports,['id','month','title','author','summary'],'reports'); break;
    } }

    // ---------------------- Map utilities ----------------------
    let mapInstance=null; let mapMarkers=[];
    function initMap(){ setTimeout(()=>{ if(mapInstance) mapInstance.remove(); mapInstance = L.map('map').setView([13.35,-15.30],11); L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(mapInstance); mapMarkers.forEach(m=>m.remove); mapMarkers=[]; villages.forEach(v=>{ const m=L.marker([v.lat,v.lon]).addTo(mapInstance).bindPopup(`<strong>${v.village}</strong><br/>Pop: ${v.pop}<br/>Chief: ${v.chief}`); mapMarkers.push(m); }); },200); }
    function initDistrictMap(name){ app.querySelectorAll('#map') && setTimeout(()=>{ const el = document.createElement('div'); el.id='districtMap'; el.style.height='250px'; const card = app.querySelector('.card'); if(card) card.appendChild(el); const vs = villages.filter(v=>v.district===name); const m=L.map(el).setView([vs[0].lat,vs[0].lon],12); L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(m); vs.forEach(v=>L.circleMarker([v.lat,v.lon],{radius:6,fillColor:'#d4af37',fillOpacity:0.9}).addTo(m).bindPopup(v.village)); },300); }
    function initSingleVillageMap(v){ setTimeout(()=>{ const el = document.createElement('div'); el.id='villageMap'; el.style.height='220px'; const container = app.querySelector('.card'); if(container) container.appendChild(el); const m=L.map(el).setView([v.lat,v.lon],14); L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(m); L.marker([v.lat,v.lon]).addTo(m).bindPopup(v.village); },300); }

    // ---------------------- Exports & download helpers ----------------------
    function downloadSection(section){ switch(section){
      case 'villages': download('villages.csv', toCSV(villages,['district','village','lat','lon','pop','households','chief','alkalo','water_points','primary_school','health_post','council'])); break;
      case 'agriculture': download('agriculture.csv', toCSV(agriculture)); break;
      case 'health': download('health.csv', toCSV(health)); break;
      case 'education': download('education.csv', toCSV(education)); break;
      case 'infrastructure': download('infrastructure.csv', toCSV(infrastructure)); break;
      case 'security': download('security.csv', toCSV(security)); break;
      case 'disasters': download('disasters.csv', toCSV(disasters)); break;
      case 'finance': download('finance.csv', toCSV(finance)); break;
      case 'staff': download('staff.csv', toCSV(staff)); break;
      case 'ngos': download('ngos.csv', toCSV(ngos)); break;
      case 'reports': download('reports.csv', toCSV(reports)); break;
    } }

    document.getElementById('exportZip').addEventListener('click', async ()=>{
      const zip = new JSZip(); zip.file('villages.csv', toCSV(villages,['district','village','lat','lon','pop','households','chief','alkalo','water_points','primary_school','health_post','council'])); zip.file('agriculture.csv', toCSV(agriculture)); zip.file('health.csv', toCSV(health)); zip.file('education.csv', toCSV(education)); zip.file('infrastructure.csv', toCSV(infrastructure)); zip.file('security.csv', toCSV(security)); zip.file('disasters.csv', toCSV(disasters)); zip.file('finance.csv', toCSV(finance)); zip.file('staff.csv', toCSV(staff)); zip.file('ngos.csv', toCSV(ngos)); zip.file('reports.csv', toCSV(reports)); const blob = await zip.generateAsync({type:'blob'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='LRR-Governor-Data.zip'; a.click(); });

    function downloadSingleVillage(name){ const v = villages.find(x=>x.village===name); const rows = [Object.keys(v).join(',') , Object.values(v).join(',')].join('
'); download(`${name.replace(/ /g,'_')}_village.csv`, rows); }

    // ---------------------- Simple edit handlers ----------------------
    window.editRecord = function(section, id){ alert('Edit record: '+section+' id:'+id+' — For prototype, use console or add endpoints.'); }
    window.editRecordInline = function(id,cols){ alert('Inline edit not implemented in prototype UI. Use JSON add function or console.'); }

    // ---------------------- Navigation wiring ----------------------
    document.querySelectorAll('.navlink').forEach(a=>a.addEventListener('click',e=>{ e.preventDefault(); const p=a.getAttribute('data-page'); if(['villages','agriculture','health','education','infrastructure','security','disaster','finance','staff','ngos','reports'].includes(p)) renderSectionList(p); else if(p==='districts') renderDistricts(); else renderHome(); }))

    // ---------------------- Helper UI for adding records quickly (console recommended) ----------------------
    // Expose API to console for power users
    window.LRR = {districts,villages,agriculture,health,education,infrastructure,security,disasters,finance,staff,ngos,reports,toCSV,downloadSection};

    // initial page
    renderHome();

    // ---------------------- Help/Guide modal ----------------------
    document.getElementById('helpBtn').addEventListener('click',()=>{
      alert('This is a full multi-page prototype SPA. Use the sidebar to navigate. Click Export to download per-section CSVs. For production: deploy files to GitHub Pages and replace sample data with official records and GPS coordinates.');
    });

    // ---------------------- End of script ----------------------
  </script></body>
</html>
