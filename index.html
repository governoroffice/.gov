<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Governor's Command Center | Lower River Region</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        /* ===== MODERN COLOR THEME ===== */
        :root {
            --primary-gold: #FFC107;
            --dark-gold: #FFA000;
            --light-gold: #FFECB3;
            --silver: #E0E0E0;
            --diamond-blue: #4FC3F7;
            --light-green: #81C784;
            --dark-green: #388E3C;
            --charcoal: #263238;
            --slate: #37474F;
            --light-gray: #F5F7FA;
            --white: #FFFFFF;
            --danger: #F44336;
            --warning: #FF9800;
            --success: #4CAF50;
            --info: #2196F3;
            --purple: #9C27B0;
            --border-radius: 12px;
            --shadow-light: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-medium: 0 6px 20px rgba(0, 0, 0, 0.12);
            --shadow-heavy: 0 10px 30px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        /* ===== BASE RESET ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--charcoal);
            overflow-x: hidden;
        }

        /* ===== SECURE LOGIN SYSTEM ===== */
        .login-container {
            display: flex;
            min-height: 100vh;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .login-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 50px;
            width: 100%;
            max-width: 450px;
            box-shadow: var(--shadow-heavy);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .login-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(to right, var(--primary-gold), var(--dark-gold));
        }

        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo i {
            font-size: 48px;
            color: var(--primary-gold);
            margin-bottom: 15px;
            display: block;
        }

        .login-logo h1 {
            font-size: 24px;
            font-weight: 700;
            color: var(--charcoal);
            margin-bottom: 5px;
        }

        .login-logo p {
            color: var(--slate);
            font-size: 14px;
            opacity: 0.8;
        }

        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--charcoal);
            font-size: 14px;
        }

        .password-wrapper {
            position: relative;
        }

        .form-control {
            width: 100%;
            padding: 14px 45px 14px 15px;
            border: 2px solid #E0E0E0;
            border-radius: 10px;
            font-size: 15px;
            transition: var(--transition);
            background: var(--white);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-gold);
            box-shadow: 0 0 0 3px rgba(255, 193, 7, 0.1);
        }

        .toggle-password {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--slate);
            cursor: pointer;
            font-size: 18px;
        }

        .login-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary-gold), var(--dark-gold));
            color: var(--charcoal);
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 193, 7, 0.3);
        }

        .login-btn:active {
            transform: translateY(0);
        }

        .error-message {
            background: rgba(244, 67, 54, 0.1);
            color: var(--danger);
            padding: 12px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 14px;
            display: none;
            border-left: 4px solid var(--danger);
        }

        .security-note {
            margin-top: 25px;
            padding: 15px;
            background: rgba(33, 150, 243, 0.05);
            border-radius: 8px;
            font-size: 13px;
            color: var(--slate);
            text-align: center;
            border: 1px dashed rgba(33, 150, 243, 0.3);
        }

        .session-timeout {
            position: absolute;
            bottom: 15px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 12px;
            color: var(--slate);
            opacity: 0.7;
        }

        /* ===== MAIN DASHBOARD ===== */
        .dashboard-container {
            display: none;
            min-height: 100vh;
            background: var(--light-gray);
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, var(--charcoal) 0%, #1a1a2e 100%);
            color: var(--white);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: var(--shadow-medium);
            transition: var(--transition);
        }

        .sidebar-header {
            padding: 25px;
            background: rgba(0, 0, 0, 0.3);
            border-bottom: 2px solid var(--primary-gold);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .sidebar-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary-gold), var(--dark-gold));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            color: var(--charcoal);
        }

        .user-info h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .user-info p {
            font-size: 13px;
            opacity: 0.8;
        }

        .nav-section {
            padding: 20px 0;
        }

        .nav-section-title {
            padding: 0 25px 15px;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 600;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            position: relative;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 14px 25px;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: var(--transition);
            border-left: 4px solid transparent;
            font-size: 14px;
            font-weight: 500;
        }

        .nav-link i {
            margin-right: 12px;
            width: 20px;
            font-size: 16px;
        }

        .nav-link:hover {
            background: rgba(255, 193, 7, 0.1);
            color: var(--white);
            border-left-color: var(--primary-gold);
        }

        .nav-link.active {
            background: rgba(255, 193, 7, 0.15);
            color: var(--primary-gold);
            border-left-color: var(--primary-gold);
            font-weight: 600;
        }

        .nav-badge {
            margin-left: auto;
            background: var(--danger);
            color: white;
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 10px;
            font-weight: 600;
            min-width: 22px;
            text-align: center;
        }

        /* ===== DROPDOWN MENUS ===== */
        .nav-dropdown {
            max-height: 0;
            overflow: hidden;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 0 0 8px 8px;
            margin: 0 10px;
            transition: max-height 0.4s ease;
        }

        .nav-dropdown.show {
            max-height: 300px;
        }

        .dropdown-toggle::after {
            content: '\f078';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            margin-left: auto;
            transition: transform 0.3s;
            font-size: 12px;
        }

        .dropdown-toggle.active::after {
            transform: rotate(180deg);
        }

        .dropdown-item {
            display: block;
            padding: 10px 15px 10px 50px;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            font-size: 13.5px;
            transition: var(--transition);
            border-left: 2px solid transparent;
        }

        .dropdown-item:hover {
            color: var(--white);
            background: rgba(255, 255, 255, 0.05);
            border-left-color: var(--silver);
        }

        .dropdown-item.active {
            color: var(--primary-gold);
            border-left-color: var(--primary-gold);
        }

        /* ===== MAIN CONTENT ===== */
        .main-content {
            margin-left: 280px;
            min-height: 100vh;
        }

        /* ===== TOP NAVBAR ===== */
        .top-navbar {
            background: var(--white);
            padding: 0 30px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow-light);
            position: sticky;
            top: 0;
            z-index: 999;
            border-bottom: 1px solid #eaeaea;
        }

        .navbar-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .breadcrumb-item {
            color: var(--slate);
            text-decoration: none;
        }

        .breadcrumb-item:hover {
            color: var(--primary-gold);
        }

        .breadcrumb-divider {
            color: var(--silver);
        }

        .navbar-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .navbar-search {
            position: relative;
        }

        .search-input {
            padding: 10px 40px 10px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            width: 250px;
            transition: var(--transition);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-gold);
            box-shadow: 0 0 0 3px rgba(255, 193, 7, 0.1);
        }

        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--slate);
        }

        .alert-badge {
            position: relative;
            cursor: pointer;
        }

        .alert-icon {
            font-size: 20px;
            color: var(--slate);
            transition: var(--transition);
        }

        .alert-icon:hover {
            color: var(--warning);
        }

        .alert-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            font-size: 11px;
            font-weight: 700;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .user-menu {
            position: relative;
        }

        .user-menu-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            background: none;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .user-menu-btn:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .user-avatar-small {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--primary-gold), var(--dark-gold));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: var(--charcoal);
            font-size: 14px;
        }

        .user-name {
            font-weight: 600;
            font-size: 14px;
        }

        .user-menu-dropdown {
            position: absolute;
            top: calc(100% + 10px);
            right: 0;
            background: var(--white);
            border-radius: 8px;
            box-shadow: var(--shadow-medium);
            width: 200px;
            display: none;
            overflow: hidden;
            z-index: 1001;
        }

        .user-menu-dropdown.show {
            display: block;
        }

        .user-menu-item {
            display: block;
            padding: 12px 20px;
            color: var(--charcoal);
            text-decoration: none;
            font-size: 14px;
            transition: var(--transition);
            border-left: 3px solid transparent;
        }

        .user-menu-item:hover {
            background: var(--light-gray);
            border-left-color: var(--primary-gold);
        }

        /* ===== CONTENT AREA ===== */
        .content-area {
            padding: 30px;
        }

        /* ===== PAGE HEADER ===== */
        .page-header {
            margin-bottom: 30px;
        }

        .page-header h1 {
            font-size: 28px;
            font-weight: 700;
            color: var(--charcoal);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .page-header p {
            color: var(--slate);
            font-size: 16px;
            line-height: 1.6;
        }

        /* ===== DASHBOARD CARDS ===== */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .metric-card {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow-light);
            transition: var(--transition);
            border-top: 4px solid;
            position: relative;
            overflow: hidden;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-medium);
        }

        .metric-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .metric-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--charcoal);
        }

        .metric-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .metric-value {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .metric-trend {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
        }

        .trend-up {
            color: var(--success);
        }

        .trend-down {
            color: var(--danger);
        }

        .metric-footer {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: var(--slate);
        }

        /* ===== DATA SECTIONS ===== */
        .data-section {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-light);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .section-header h2 {
            font-size: 20px;
            font-weight: 700;
            color: var(--charcoal);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-gold), var(--dark-gold));
            color: var(--charcoal);
        }

        .btn-secondary {
            background: var(--silver);
            color: var(--charcoal);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-info {
            background: var(--info);
            color: white;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* ===== TABLES ===== */
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid #eee;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1000px;
        }

        .data-table thead {
            background: linear-gradient(135deg, var(--charcoal), var(--slate));
        }

        .data-table th {
            padding: 16px 20px;
            text-align: left;
            color: white;
            font-weight: 600;
            font-size: 14px;
            white-space: nowrap;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }

        .data-table th:last-child {
            border-right: none;
        }

        .data-table tbody tr {
            border-bottom: 1px solid #eee;
            transition: var(--transition);
        }

        .data-table tbody tr:hover {
            background: rgba(255, 193, 7, 0.05);
        }

        .data-table td {
            padding: 14px 20px;
            font-size: 14px;
            color: var(--charcoal);
            vertical-align: middle;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .status-active {
            background: rgba(76, 175, 80, 0.1);
            color: var(--success);
        }

        .status-pending {
            background: rgba(255, 152, 0, 0.1);
            color: var(--warning);
        }

        .status-critical {
            background: rgba(244, 67, 54, 0.1);
            color: var(--danger);
        }

        .status-completed {
            background: rgba(33, 150, 243, 0.1);
            color: var(--info);
        }

        .table-actions {
            display: flex;
            gap: 8px;
        }

        .table-btn {
            padding: 6px 12px;
            border-radius: 6px;
            border: none;
            background: rgba(0, 0, 0, 0.05);
            color: var(--charcoal);
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .table-btn:hover {
            background: var(--primary-gold);
            color: var(--charcoal);
        }

        /* ===== MAP CONTAINER ===== */
        .map-section {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-light);
        }

        .map-container {
            height: 500px;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 20px;
            border: 1px solid #eee;
        }

        #region-map {
            width: 100%;
            height: 100%;
        }

        /* ===== MODALS ===== */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal {
            background: var(--white);
            border-radius: var(--border-radius);
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: var(--shadow-heavy);
            animation: modalSlide 0.3s ease;
        }

        @keyframes modalSlide {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 25px 30px;
            background: linear-gradient(135deg, var(--charcoal), var(--slate));
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-size: 20px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .modal-body {
            padding: 30px;
            overflow-y: auto;
            max-height: calc(90vh - 130px);
        }

        /* ===== EXPORT MODAL ===== */
        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .export-option {
            background: var(--light-gray);
            border-radius: 8px;
            padding: 25px;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
            border: 2px solid transparent;
        }

        .export-option:hover {
            border-color: var(--primary-gold);
            transform: translateY(-5px);
        }

        .export-option i {
            font-size: 36px;
            color: var(--primary-gold);
            margin-bottom: 15px;
        }

        .export-option h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .export-option p {
            font-size: 13px;
            color: var(--slate);
        }

        /* ===== CHARTS ===== */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow-light);
        }

        .chart-card h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--charcoal);
        }

        .chart-container {
            height: 300px;
            position: relative;
        }

        /* ===== ALERTS ===== */
        .alerts-container {
            display: grid;
            gap: 15px;
        }

        .alert-item {
            background: var(--white);
            border-radius: 8px;
            padding: 20px;
            display: flex;
            align-items: flex-start;
            gap: 15px;
            border-left: 4px solid;
            box-shadow: var(--shadow-light);
            transition: var(--transition);
        }

        .alert-item:hover {
            transform: translateX(5px);
        }

        .alert-critical {
            border-left-color: var(--danger);
            background: linear-gradient(to right, rgba(244, 67, 54, 0.05), white);
        }

        .alert-high {
            border-left-color: var(--warning);
            background: linear-gradient(to right, rgba(255, 152, 0, 0.05), white);
        }

        .alert-medium {
            border-left-color: var(--info);
            background: linear-gradient(to right, rgba(33, 150, 243, 0.05), white);
        }

        .alert-icon-container {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .alert-critical .alert-icon-container {
            background: rgba(244, 67, 54, 0.1);
            color: var(--danger);
        }

        .alert-high .alert-icon-container {
            background: rgba(255, 152, 0, 0.1);
            color: var(--warning);
        }

        .alert-medium .alert-icon-container {
            background: rgba(33, 150, 243, 0.1);
            color: var(--info);
        }

        .alert-content {
            flex: 1;
        }

        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .alert-title {
            font-weight: 600;
            font-size: 15px;
        }

        .alert-time {
            font-size: 12px;
            color: var(--slate);
        }

        .alert-description {
            font-size: 14px;
            color: var(--charcoal);
            margin-bottom: 12px;
        }

        .alert-actions {
            display: flex;
            gap: 10px;
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 1200px) {
            .sidebar {
                width: 250px;
                transform: translateX(-100%);
                z-index: 2000;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .top-navbar {
                padding: 0 20px;
            }
            
            .content-area {
                padding: 20px;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .search-input {
                width: 200px;
            }
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .section-actions {
                width: 100%;
                flex-wrap: wrap;
            }
            
            .search-input {
                width: 150px;
            }
            
            .user-name {
                display: none;
            }
        }

        @media (max-width: 576px) {
            .login-card {
                padding: 30px 20px;
            }
            
            .content-area {
                padding: 15px;
            }
            
            .modal {
                margin: 10px;
            }
            
            .modal-body {
                padding: 20px;
            }
        }

        /* ===== LOADING INDICATOR ===== */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 20px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary-gold);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading p {
            color: white;
            font-size: 16px;
        }

        /* ===== NOTIFICATION ===== */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--white);
            border-radius: 8px;
            padding: 15px 20px;
            box-shadow: var(--shadow-medium);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 3000;
            transform: translateX(150%);
            transition: transform 0.3s ease;
            max-width: 400px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .notification-success {
            border-left: 4px solid var(--success);
        }

        .notification-success .notification-icon {
            background: rgba(76, 175, 80, 0.1);
            color: var(--success);
        }

        .notification-error {
            border-left: 4px solid var(--danger);
        }

        .notification-error .notification-icon {
            background: rgba(244, 67, 54, 0.1);
            color: var(--danger);
        }

        .notification-info {
            border-left: 4px solid var(--info);
        }

        .notification-info .notification-icon {
            background: rgba(33, 150, 243, 0.1);
            color: var(--info);
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 14px;
        }

        .notification-message {
            font-size: 13px;
            color: var(--slate);
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--slate);
            cursor: pointer;
            font-size: 16px;
        }

        /* ===== MOBILE MENU TOGGLE ===== */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 24px;
            color: var(--charcoal);
            cursor: pointer;
        }

        @media (max-width: 1200px) {
            .mobile-menu-toggle {
                display: block;
            }
        }
    </style>
</head>
<body>
    <!-- SECURE LOGIN SYSTEM -->
    <div class="login-container" id="loginContainer">
        <div class="login-card">
            <div class="login-logo">
                <i class="fas fa-shield-alt"></i>
                <h1>Governor's Command Center</h1>
                <p>Lower River Region â€¢ Republic of The Gambia</p>
            </div>
            
            <form id="loginForm" onsubmit="return false">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" class="form-control" placeholder="Enter your username" autocomplete="off" required>
                </div>
                
                <div class="form-group">
                    <label for="password">Password</label>
                    <div class="password-wrapper">
                        <input type="password" id="password" class="form-control" placeholder="Enter your password" autocomplete="off" required>
                        <button type="button" class="toggle-password" id="togglePassword">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <button type="submit" class="login-btn" id="loginButton">
                    <i class="fas fa-lock"></i> Secure Login
                </button>
                
                <div class="error-message" id="loginError">
                    <i class="fas fa-exclamation-circle"></i> Invalid credentials. Please try again.
                </div>
            </form>
            
            <div class="security-note">
                <i class="fas fa-info-circle"></i> This system contains sensitive regional data. Access is strictly monitored and logged.
            </div>
            
            <div class="session-timeout">
                <i class="fas fa-clock"></i> Session will expire in 30 minutes of inactivity
            </div>
        </div>
    </div>

    <!-- MAIN DASHBOARD -->
    <div class="dashboard-container" id="dashboardContainer">
        <!-- SIDEBAR NAVIGATION -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-avatar">AJ</div>
                <div class="user-info">
                    <h3>Hon. Alhaji S. Jawara</h3>
                    <p>Regional Governor</p>
                </div>
            </div>

            <!-- Dashboard Section -->
            <div class="nav-section">
                <div class="nav-section-title">Dashboard</div>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#" class="nav-link active" data-section="overview">
                            <i class="fas fa-tachometer-alt"></i> Overview
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-section="analytics">
                            <i class="fas fa-chart-line"></i> Analytics
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-section="reports">
                            <i class="fas fa-file-alt"></i> Reports
                            <span class="nav-badge">12</span>
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Security & RECSEC -->
            <div class="nav-section">
                <div class="nav-section-title">Security & RECSEC</div>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="security">
                            <i class="fas fa-shield-alt"></i> Security Command
                            <span class="nav-badge">7</span>
                        </a>
                        <div class="nav-dropdown" id="security-dropdown">
                            <a href="#" class="dropdown-item" data-section="incidents">Incidents & Alerts</a>
                            <a href="#" class="dropdown-item" data-section="police">Police Reports</a>
                            <a href="#" class="dropdown-item" data-section="immigration">Immigration</a>
                            <a href="#" class="dropdown-item" data-section="fire-rescue">Fire & Rescue</a>
                            <a href="#" class="dropdown-item" data-section="border-security">Border Security</a>
                        </div>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-section="recsec">
                            <i class="fas fa-users"></i> RECSEC Committee
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-section="surveillance">
                            <i class="fas fa-map-marked-alt"></i> Regional Map
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Local Government -->
            <div class="nav-section">
                <div class="nav-section-title">Local Government</div>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="councils">
                            <i class="fas fa-landmark"></i> Area Councils
                        </a>
                        <div class="nav-dropdown" id="councils-dropdown">
                            <a href="#" class="dropdown-item" data-section="jarra-west">Jarra West Council</a>
                            <a href="#" class="dropdown-item" data-section="jarra-central">Jarra Central Council</a>
                            <a href="#" class="dropdown-item" data-section="jarra-east">Jarra East Council</a>
                            <a href="#" class="dropdown-item" data-section="kiang-west">Kiang West Council</a>
                            <a href="#" class="dropdown-item" data-section="kiang-central">Kiang Central Council</a>
                            <a href="#" class="dropdown-item" data-section="kiang-east">Kiang East Council</a>
                        </div>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-section="traditional-leaders">
                            <i class="fas fa-crown"></i> Traditional Leaders
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-section="revenue">
                            <i class="fas fa-money-bill-wave"></i> Revenue Collection
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Ministry Departments -->
            <div class="nav-section">
                <div class="nav-section-title">Ministry Departments</div>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="health">
                            <i class="fas fa-hospital"></i> Health Directorate
                        </a>
                        <div class="nav-dropdown" id="health-dropdown">
                            <a href="#" class="dropdown-item" data-section="disease-surveillance">Disease Surveillance</a>
                            <a href="#" class="dropdown-item" data-section="facilities">Health Facilities</a>
                            <a href="#" class="dropdown-item" data-section="drugs-supply">Drugs & Supply</a>
                        </div>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-section="agriculture">
                            <i class="fas fa-tractor"></i> Agriculture
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-section="education">
                            <i class="fas fa-graduation-cap"></i> Education
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-section="works">
                            <i class="fas fa-road"></i> Works & Infrastructure
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-section="youth-sports">
                            <i class="fas fa-running"></i> Youth & Sports
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-section="women-affairs">
                            <i class="fas fa-female"></i> Women's Affairs
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Development Projects -->
            <div class="nav-section">
                <div class="nav-section-title">Development</div>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-section="projects">
                            <i class="fas fa-hard-hat"></i> Active Projects
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-section="development-partners">
                            <i class="fas fa-handshake"></i> Development Partners
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Data Management -->
            <div class="nav-section">
                <div class="nav-section-title">Data & Tools</div>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-section="export-data">
                            <i class="fas fa-download"></i> Export Data
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-section="reports-generator">
                            <i class="fas fa-file-pdf"></i> Report Generator
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-section="settings">
                            <i class="fas fa-cog"></i> Settings
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- MAIN CONTENT -->
        <div class="main-content">
            <!-- TOP NAVBAR -->
            <div class="top-navbar">
                <div class="navbar-left">
                    <button class="mobile-menu-toggle" id="mobileMenuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="breadcrumb" id="breadcrumb">
                        <a href="#" class="breadcrumb-item" data-section="overview">Dashboard</a>
                        <span class="breadcrumb-divider">/</span>
                        <span class="breadcrumb-item active">Overview</span>
                    </div>
                </div>
                
                <div class="navbar-right">
                    <div class="navbar-search">
                        <input type="text" class="search-input" placeholder="Search reports, incidents...">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                    
                    <div class="alert-badge" onclick="showSection('alerts')">
                        <i class="fas fa-bell alert-icon"></i>
                        <span class="alert-count" id="alertCount">3</span>
                    </div>
                    
                    <div class="user-menu" id="userMenu">
                        <button class="user-menu-btn" onclick="toggleUserMenu()">
                            <div class="user-avatar-small">AJ</div>
                            <span class="user-name">Governor</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="user-menu-dropdown" id="userMenuDropdown">
                            <a href="#" class="user-menu-item" data-section="profile">
                                <i class="fas fa-user"></i> My Profile
                            </a>
                            <a href="#" class="user-menu-item" onclick="openSettings()">
                                <i class="fas fa-cog"></i> Settings
                            </a>
                            <div class="divider"></div>
                            <a href="#" class="user-menu-item" onclick="logout()">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CONTENT AREA -->
            <div class="content-area" id="contentArea">
                <!-- OVERVIEW SECTION -->
                <section id="overview" class="dashboard-section active">
                    <div class="page-header">
                        <h1><i class="fas fa-tachometer-alt"></i> Regional Overview</h1>
                        <p>Comprehensive view of Lower River Region operations and key performance indicators</p>
                    </div>

                    <!-- METRIC CARDS -->
                    <div class="dashboard-grid" id="metricCards">
                        <!-- Cards will be populated by JavaScript -->
                    </div>

                    <!-- REGIONAL MAP -->
                    <div class="map-section">
                        <div class="section-header">
                            <h2><i class="fas fa-map-marked-alt"></i> Regional Security Map</h2>
                            <div class="section-actions">
                                <button class="btn btn-secondary" onclick="downloadMapCSV()">
                                    <i class="fas fa-download"></i> Export Map Data
                                </button>
                                <button class="btn btn-primary" onclick="refreshMap()">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                        </div>
                        <div class="map-container">
                            <div id="region-map"></div>
                        </div>
                    </div>

                    <!-- RECENT ALERTS -->
                    <div class="data-section">
                        <div class="section-header">
                            <h2><i class="fas fa-exclamation-triangle"></i> Recent Alerts</h2>
                            <div class="section-actions">
                                <button class="btn btn-danger" onclick="showSection('alerts')">
                                    <i class="fas fa-eye"></i> View All
                                </button>
                            </div>
                        </div>
                        <div class="alerts-container" id="recentAlerts">
                            <!-- Alerts will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- QUICK ACTIONS -->
                    <div class="data-section">
                        <div class="section-header">
                            <h2><i class="fas fa-bolt"></i> Quick Actions</h2>
                        </div>
                        <div class="section-actions">
                            <button class="btn btn-primary" onclick="generateWeeklyReport()">
                                <i class="fas fa-file-pdf"></i> Weekly Report
                            </button>
                            <button class="btn btn-info" onclick="conveneRECSEC()">
                                <i class="fas fa-users"></i> Convene RECSEC
                            </button>
                            <button class="btn btn-success" onclick="openExportModal()">
                                <i class="fas fa-download"></i> Export Data
                            </button>
                            <button class="btn btn-secondary" onclick="showSection('reports-generator')">
                                <i class="fas fa-print"></i> Generate Reports
                            </button>
                        </div>
                    </div>
                </section>

                <!-- INCIDENTS SECTION -->
                <section id="incidents" class="dashboard-section">
                    <div class="page-header">
                        <h1><i class="fas fa-exclamation-circle"></i> Security Incidents</h1>
                        <p>Manage and monitor security incidents across the region</p>
                    </div>

                    <div class="data-section">
                        <div class="section-header">
                            <h2><i class="fas fa-clipboard-list"></i> Recent Incidents</h2>
                            <div class="section-actions">
                                <button class="btn btn-primary" onclick="exportToCSV('incidents')">
                                    <i class="fas fa-download"></i> Download CSV
                                </button>
                                <button class="btn btn-success" onclick="exportToExcel('incidents')">
                                    <i class="fas fa-file-excel"></i> Excel
                                </button>
                                <button class="btn btn-info" onclick="addNewIncident()">
                                    <i class="fas fa-plus"></i> New Incident
                                </button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="data-table" id="incidentsTable">
                                <thead>
                                    <tr>
                                        <th>Incident ID</th>
                                        <th>Date</th>
                                        <th>District</th>
                                        <th>Type</th>
                                        <th>Severity</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="incidentsTableBody">
                                    <!-- Data will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- REPORTS SECTION -->
                <section id="reports" class="dashboard-section">
                    <div class="page-header">
                        <h1><i class="fas fa-file-alt"></i> Departmental Reports</h1>
                        <p>View and manage reports from all departments and agencies</p>
                    </div>

                    <div class="data-section">
                        <div class="section-header">
                            <h2><i class="fas fa-inbox"></i> Pending Reports</h2>
                            <div class="section-actions">
                                <button class="btn btn-primary" onclick="exportToCSV('reports')">
                                    <i class="fas fa-download"></i> Export CSV
                                </button>
                                <button class="btn btn-danger" onclick="sendReminders()">
                                    <i class="fas fa-bell"></i> Send Reminders
                                </button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="data-table" id="reportsTable">
                                <thead>
                                    <tr>
                                        <th>Department</th>
                                        <th>Report Type</th>
                                        <th>Due Date</th>
                                        <th>Submitted</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="reportsTableBody">
                                    <!-- Data will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- EXPORT DATA SECTION -->
                <section id="export-data" class="dashboard-section">
                    <div class="page-header">
                        <h1><i class="fas fa-download"></i> Data Export</h1>
                        <p>Export regional data in various formats for reporting and analysis</p>
                    </div>

                    <div class="data-section">
                        <div class="section-header">
                            <h2><i class="fas fa-database"></i> Available Datasets</h2>
                        </div>
                        <div class="export-options" id="exportOptions">
                            <!-- Export options will be populated by JavaScript -->
                        </div>
                    </div>
                </section>

                <!-- Additional sections would be added here -->
                <!-- Due to length constraints, I'm focusing on core functionality -->

            </div>
        </div>
    </div>

    <!-- LOADING OVERLAY -->
    <div class="loading" id="loadingOverlay">
        <div class="spinner"></div>
        <p>Processing your request...</p>
    </div>

    <!-- NOTIFICATION -->
    <div class="notification" id="notification">
        <div class="notification-icon">
            <i class="fas fa-check"></i>
        </div>
        <div class="notification-content">
            <div class="notification-title" id="notificationTitle">Success</div>
            <div class="notification-message" id="notificationMessage">Operation completed successfully</div>
        </div>
        <button class="notification-close" onclick="hideNotification()">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- MODALS -->
    <div class="modal-overlay" id="exportModal">
        <div class="modal">
            <div class="modal-header">
                <h2><i class="fas fa-download"></i> Export Data</h2>
                <button class="modal-close" onclick="closeExportModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="export-options" id="modalExportOptions">
                    <!-- Export options will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==============================================
        // ENHANCED SECURITY SYSTEM
        // ==============================================
        
        // Encrypted password storage (in real system, this would be server-side)
        const ENCRYPTED_PASSWORD = btoa("gambia@2025"); // Base64 encoding
        
        // Auto-logout timer (30 minutes)
        let logoutTimer;
        const SESSION_TIMEOUT = 30 * 60 * 1000; // 30 minutes
        
        // Data storage
        let dashboardData = {
            lastLogin: null,
            sessionStart: null,
            accessLog: []
        };

        // ==============================================
        // COMPLETE DATABASE - ALL DATA AND DETAILS
        // ==============================================
        
        // DISTRICTS OF LOWER RIVER REGION
        const districts = [
            { id: 1, name: "Jarra West", capital: "Soma", population: 82500, area_km2: 425, villages: 42 },
            { id: 2, name: "Jarra Central", capital: "Jarra Soma", population: 51200, area_km2: 310, villages: 32 },
            { id: 3, name: "Jarra East", capital: "Jali", population: 38700, area_km2: 285, villages: 28 },
            { id: 4, name: "Kiang West", capital: "Dumbuto", population: 46500, area_km2: 395, villages: 36 },
            { id: 5, name: "Kiang Central", capital: "Kiang Kwinella", population: 42100, area_km2: 320, villages: 31 },
            { id: 6, name: "Kiang East", capital: "Kwinella", population: 39800, area_km2: 295, villages: 29 }
        ];

        // VILLAGES WITH ALKALOS (Traditional Village Heads)
        const villages = [
            { id: 1, district_id: 1, name: "Soma", alkalos_name: "Alhagie Lamin Ceesay", population: 18500, contact: "N/A" },
            { id: 2, district_id: 1, name: "Bureng", alkalos_name: "Ousman Jallow", population: 4200, contact: "+220-1234567" },
            { id: 3, district_id: 1, name: "Kwinella", alkalos_name: "Ebrima Sanyang", population: 3200, contact: "+220-2345678" },
            { id: 4, district_id: 1, name: "Badume", alkalos_name: "Modou Njie", population: 2100, contact: "N/A" },
            { id: 5, district_id: 2, name: "Jarra Soma", alkalos_name: "Alhagie Demba Jawo", population: 8400, contact: "+220-3456789" },
            { id: 6, district_id: 2, name: "Sankwia", alkalos_name: "Binta Jallow", population: 3800, contact: "+220-4567890" },
            { id: 7, district_id: 2, name: "Brikama Ba", alkalos_name: "Lamin S. Jatta", population: 5200, contact: "N/A" },
            { id: 8, district_id: 3, name: "Jali", alkalos_name: "Alhagie Malick Njie", population: 3100, contact: "+220-5678901" },
            { id: 9, district_id: 3, name: "Pakaliba", alkalos_name: "Fatou B. Njie", population: 2800, contact: "N/A" },
            { id: 10, district_id: 3, name: "Kuli Kunda", alkalos_name: "Omar Jallow", population: 1900, contact: "+220-6789012" },
            { id: 11, district_id: 4, name: "Dumbuto", alkalos_name: "Alhagie Lamin Manneh", population: 2600, contact: "+220-7890123" },
            { id: 12, district_id: 4, name: "Tendaba", alkalos_name: "Mariama Sarr", population: 1500, contact: "N/A" },
            { id: 13, district_id: 4, name: "Massembe", alkalos_name: "Yankuba Colley", population: 3200, contact: "+220-8901234" },
            { id: 14, district_id: 5, name: "Kiang Kwinella", alkalos_name: "Alhagie Saikou Jawara", population: 4100, contact: "+220-9012345" },
            { id: 15, district_id: 5, name: "Jiroff", alkalos_name: "Hawa Bah", population: 2900, contact: "N/A" },
            { id: 16, district_id: 5, name: "Darsilami", alkalos_name: "Kebba K. Manneh", population: 3400, contact: "+220-0123456" },
            { id: 17, district_id: 6, name: "Kwinella", alkalos_name: "Alhagie Abdoulie Jobe", population: 3700, contact: "N/A" },
            { id: 18, district_id: 6, name: "Dumbutu", alkalos_name: "Ami Njie", population: 2200, contact: "+220-1122334" },
            { id: 19, district_id: 6, name: "Sutukoba", alkalos_name: "Lamin B. Camara", population: 3100, contact: "+220-2233445" }
        ];

        // SEYFOS (District Chiefs)
        const seyfos = [
            { id: 1, district_id: 1, name: "Alhagie Demba Jawo", title: "Seyfo of Jarra West", years_served: 12, contact: "+220-3344556" },
            { id: 2, district_id: 2, name: "Alhagie Lamin S. Jatta", title: "Seyfo of Jarra Central", years_served: 8, contact: "+220-4455667" },
            { id: 3, district_id: 3, name: "Alhagie Malick Njie", title: "Seyfo of Jarra East", years_served: 15, contact: "+220-5566778" },
            { id: 4, district_id: 4, name: "Alhagie Lamin Manneh", title: "Seyfo of Kiang West", years_served: 10, contact: "+220-6677889" },
            { id: 5, district_id: 5, name: "Alhagie Saikou Jawara", title: "Seyfo of Kiang Central", years_served: 7, contact: "+220-7788990" },
            { id: 6, district_id: 6, name: "Alhagie Abdoulie Jobe", title: "Seyfo of Kiang East", years_served: 9, contact: "+220-8899001" }
        ];

        // SECURITY INCIDENTS
        const securityIncidents = [
            { id: "SEC-2024-001", date: "2024-01-15", time: "14:30", district: "Jarra West", village: "Soma", type: "Theft", severity: "Medium", status: "Investigation Complete", reported_by: "Police Soma", description: "Livestock theft from Soma market. 5 cattle stolen.", action_taken: "2 suspects arrested, 3 cattle recovered", officer: "Supt. Lamin Ceesay" },
            { id: "SEC-2024-002", date: "2024-01-18", time: "09:15", district: "Kiang West", village: "Dumbuto", type: "Public Disorder", severity: "High", status: "Under Investigation", reported_by: "DSP Kiang West", description: "Land boundary dispute between Dumbuto and Tendaba communities.", action_taken: "Police patrol deployed, mediation ongoing", officer: "Chief Supt. Omar Jallow" },
            { id: "SEC-2024-003", date: "2024-01-20", time: "16:45", district: "Jarra Central", village: "Sankwia", type: "Road Accident", severity: "Critical", status: "Resolved", reported_by: "Traffic Unit", description: "Fatal accident on Trans-Gambia Highway. 2 fatalities, 3 injured.", action_taken: "Victims taken to hospital, road cleared", officer: "Insp. Modou Njie" },
            { id: "SEC-2024-004", date: "2024-01-22", time: "11:20", district: "Jarra West", village: "Bureng", type: "Illegal Fishing", severity: "Low", status: "Reported", reported_by: "Fisheries Dept", description: "Unauthorized fishing activity in protected area.", action_taken: "Warning issued, equipment confiscated", officer: "Officer Lamin Jatta" },
            { id: "SEC-2024-005", date: "2024-01-25", time: "13:10", district: "Kiang Central", village: "Jiroff", type: "Fire Outbreak", severity: "High", status: "Emergency Response", reported_by: "Fire Service", description: "Bush fire threatening farmlands and homes.", action_taken: "Fire trucks deployed, community mobilized", officer: "Chief Fire Officer Modou Bah" },
            { id: "SEC-2024-006", date: "2024-01-26", time: "08:30", district: "Jarra East", village: "Pakaliba", type: "Missing Person", severity: "Medium", status: "Search Ongoing", reported_by: "Family", description: "17-year-old female missing since Thursday evening.", action_taken: "Search teams deployed, family interviewed", officer: "Insp. Binta Ceesay" },
            { id: "SEC-2024-007", date: "2024-01-28", time: "22:15", district: "Kiang East", village: "Dumbutu", type: "Border Security", severity: "Medium", status: "Under Patrol", reported_by: "Immigration", description: "Suspected irregular movement at border area.", action_taken: "Border patrol intensified, checkpoints established", officer: "Chief Supt. Omar Jallow" }
        ];

        // DEVELOPMENT PROJECTS
        const developmentProjects = [
            { id: "DEV-001", name: "Soma Market Expansion", district: "Jarra West", village: "Soma", funder: "World Bank", budget: 4500000, start_date: "2023-06-01", end_date: "2024-05-30", contractor: "Gambia Builders Ltd", physical_completion: 78, financial_absorption: 65, status: "Ongoing", issues: "Delayed material delivery", contact_person: "Eng. Lamin Ceesay" },
            { id: "DEV-002", name: "Tendaba Eco-Tourism Center", district: "Kiang West", village: "Tendaba", funder: "Govt of Gambia", budget: 3200000, start_date: "2023-09-15", end_date: "2024-08-14", contractor: "Alpha Construction", physical_completion: 45, financial_absorption: 42, status: "Ongoing", issues: "Design modifications required", contact_person: "Mr. Yankuba Colley" },
            { id: "DEV-003", name: "Jarra Soma Health Center", district: "Jarra Central", village: "Jarra Soma", funder: "EU Development Fund", budget: 5800000, start_date: "2023-03-01", end_date: "2024-02-28", contractor: "Modern Builders", physical_completion: 92, financial_absorption: 88, status: "Nearing Completion", issues: "Equipment procurement delayed", contact_person: "Dr. Fatou Njie" },
            { id: "DEV-004", name: "Kiang Kwinella Solar Water Project", district: "Kiang Central", village: "Kiang Kwinella", funder: "UNDP", budget: 2100000, start_date: "2023-11-01", end_date: "2024-04-30", contractor: "Solar Solutions Gambia", physical_completion: 60, financial_absorption: 55, status: "Ongoing", issues: "Technical training needed", contact_person: "Mr. Malick Njie" },
            { id: "DEV-005", name: "Jali Rice Irrigation Scheme", district: "Jarra East", village: "Jali", funder: "IFAD", budget: 8900000, start_date: "2022-12-01", end_date: "2024-06-30", contractor: "Agri-Development Corp", physical_completion: 85, financial_absorption: 79, status: "Ongoing", issues: "Water pump maintenance", contact_person: "Mr. Ebrima Sanyang" },
            { id: "DEV-006", name: "Kwinella Road Rehabilitation", district: "Kiang East", village: "Kwinella", funder: "Govt of Gambia", budget: 6700000, start_date: "2024-01-15", end_date: "2024-07-14", contractor: "Road Masters Ltd", physical_completion: 15, financial_absorption: 12, status: "Just Started", issues: "Community compensation claims", contact_person: "Eng. Modou Njie" },
            { id: "DEV-007", name: "Kwinella Youth ICT Center", district: "Jarra West", village: "Kwinella", funder: "UNICEF", budget: 3400000, start_date: "2023-08-01", end_date: "2024-03-31", contractor: "Tech Build Africa", physical_completion: 95, financial_absorption: 93, status: "Final Phase", issues: "Internet connectivity", contact_person: "Dr. Lamin Camara" }
        ];

        // AREA COUNCIL PERFORMANCE
        const councilPerformance = [
            { council_id: "AC001", district_id: 1, name: "Jarra West Council", revenue_target: 1250000, revenue_collected: 1085000, expenditure_budget: 1100000, expenditure_actual: 1025000, service_rating: 78, chairman: "Mr. Lamin S. Jatta", vice_chair: "Ms. Binta S. Ceesay", contact: "+220-7890123" },
            { council_id: "AC002", district_id: 2, name: "Jarra Central Council", revenue_target: 980000, revenue_collected: 812000, expenditure_budget: 950000, expenditure_actual: 890000, service_rating: 82, chairman: "Ms. Fatou B. Njie", vice_chair: "Mr. Ousman Jallow", contact: "+220-8901234" },
            { council_id: "AC003", district_id: 3, name: "Jarra East Council", revenue_target: 890000, revenue_collected: 734000, expenditure_budget: 870000, expenditure_actual: 810000, service_rating: 75, chairman: "Mr. Ebrima Sanyang", vice_chair: "Ms. Hawa Bah", contact: "+220-9012345" },
            { council_id: "AC004", district_id: 4, name: "Kiang West Council", revenue_target: 1100000, revenue_collected: 925000, expenditure_budget: 1050000, expenditure_actual: 980000, service_rating: 80, chairman: "Alhagie Demba Jawo", vice_chair: "Mr. Yankuba Colley", contact: "+220-0123456" },
            { council_id: "AC005", district_id: 5, name: "Kiang Central Council", revenue_target: 950000, revenue_collected: 798000, expenditure_budget: 920000, expenditure_actual: 865000, service_rating: 77, chairman: "Mr. Malick Njie", vice_chair: "Ms. Mariama Sarr", contact: "+220-1122334" },
            { council_id: "AC006", district_id: 6, name: "Kiang East Council", revenue_target: 870000, revenue_collected: 713000, expenditure_budget: 850000, expenditure_actual: 795000, service_rating: 73, chairman: "Mr. Kebba K. Manneh", vice_chair: "Ms. Amie Njie", contact: "+220-2233445" }
        ];

        // HEALTH SECTOR DATA
        const healthData = [
            { district_id: 1, malaria_cases: 142, cholera_cases: 0, vaccination_rate: 89, drug_availability: 75, facility_count: 8, health_centers: ["Soma Major Health Center", "Kwinella Clinic", "Bureng Health Post"] },
            { district_id: 2, malaria_cases: 98, cholera_cases: 3, vaccination_rate: 85, drug_availability: 70, facility_count: 6, health_centers: ["Jarra Soma Hospital", "Sankwia Clinic", "Brikama Ba Health Post"] },
            { district_id: 3, malaria_cases: 115, cholera_cases: 1, vaccination_rate: 91, drug_availability: 82, facility_count: 5, health_centers: ["Jali Health Post", "Pakaliba Clinic", "Kuli Kunda MCH"] },
            { district_id: 4, malaria_cases: 87, cholera_cases: 0, vaccination_rate: 92, drug_availability: 80, facility_count: 7, health_centers: ["Tendaba Clinic", "Dumbuto Health Center", "Massembe MCH"] },
            { district_id: 5, malaria_cases: 103, cholera_cases: 2, vaccination_rate: 88, drug_availability: 78, facility_count: 6, health_centers: ["Kiang Central Clinic", "Jiroff Health Post", "Darsilami MCH"] },
            { district_id: 6, malaria_cases: 76, cholera_cases: 0, vaccination_rate: 95, drug_availability: 85, facility_count: 5, health_centers: ["Kiang East MCH", "Kwinella Clinic", "Sutukoba Health Post"] }
        ];

        // AGRICULTURE SECTOR DATA
        const agricultureData = [
            { district_id: 1, crop_type: "Rice", production_tons: 2850, price_per_kg: 18.5, rainfall_mm: 450, farmers_count: 1250, fertilizer_distributed: 1850 },
            { district_id: 1, crop_type: "Groundnuts", production_tons: 1950, price_per_kg: 25.7, rainfall_mm: 450, farmers_count: 980, fertilizer_distributed: 1250 },
            { district_id: 2, crop_type: "Rice", production_tons: 2150, price_per_kg: 18.2, rainfall_mm: 420, farmers_count: 1120, fertilizer_distributed: 1650 },
            { district_id: 2, crop_type: "Maize", production_tons: 1250, price_per_kg: 12.3, rainfall_mm: 420, farmers_count: 750, fertilizer_distributed: 950 },
            { district_id: 3, crop_type: "Rice", production_tons: 3250, price_per_kg: 18.8, rainfall_mm: 480, farmers_count: 1850, fertilizer_distributed: 2450 },
            { district_id: 4, crop_type: "Groundnuts", production_tons: 1650, price_per_kg: 25.5, rainfall_mm: 430, farmers_count: 850, fertilizer_distributed: 1150 },
            { district_id: 5, crop_type: "Rice", production_tons: 1950, price_per_kg: 18.3, rainfall_mm: 410, farmers_count: 1050, fertilizer_distributed: 1350 },
            { district_id: 6, crop_type: "Vegetables", production_tons: 850, price_per_kg: 30.5, rainfall_mm: 395, farmers_count: 420, fertilizer_distributed: 650 }
        ];

        // EDUCATION SECTOR DATA
        const educationData = [
            { district_id: 1, school_name: "Soma Senior Secondary", student_enrollment: 1245, teacher_count: 42, pass_rate: 78, attendance_rate: 89, infrastructure_condition: "Good" },
            { district_id: 1, school_name: "Kwinella Upper Basic", student_enrollment: 712, teacher_count: 22, pass_rate: 79, attendance_rate: 87, infrastructure_condition: "Fair" },
            { district_id: 2, school_name: "Jarra Soma Upper Basic", student_enrollment: 892, teacher_count: 26, pass_rate: 75, attendance_rate: 86, infrastructure_condition: "Good" },
            { district_id: 3, school_name: "Jali Lower Basic", student_enrollment: 478, teacher_count: 15, pass_rate: 85, attendance_rate: 92, infrastructure_condition: "Excellent" },
            { district_id: 4, school_name: "Tendaba Lower Basic", student_enrollment: 567, teacher_count: 18, pass_rate: 82, attendance_rate: 91, infrastructure_condition: "Fair" },
            { district_id: 5, school_name: "Kiang Central Senior Secondary", student_enrollment: 1034, teacher_count: 35, pass_rate: 80, attendance_rate: 88, infrastructure_condition: "Good" },
            { district_id: 6, school_name: "Kwinella Upper Basic", student_enrollment: 698, teacher_count: 21, pass_rate: 77, attendance_rate: 85, infrastructure_condition: "Poor" }
        ];

        // INFRASTRUCTURE DATA
        const infrastructureData = [
            { district_id: 1, road_type: "Major Road", length_km: 45, condition: "Fair", last_maintained: "2023-08-15", next_maintenance: "2024-03-15", budget_allocated: 450000 },
            { district_id: 1, road_type: "Minor Road", length_km: 85, condition: "Poor", last_maintained: "2022-12-10", next_maintenance: "2024-02-28", budget_allocated: 280000 },
            { district_id: 2, road_type: "Major Road", length_km: 38, condition: "Good", last_maintained: "2023-11-20", next_maintenance: "2024-08-20", budget_allocated: 320000 },
            { district_id: 3, road_type: "Bridge", length_km: 0.5, condition: "Fair", last_maintained: "2023-09-30", next_maintenance: "2024-04-30", budget_allocated: 190000 },
            { district_id: 4, road_type: "Major Road", length_km: 52, condition: "Poor", last_maintained: "2023-05-20", next_maintenance: "2024-02-15", budget_allocated: 320000 },
            { district_id: 5, road_type: "Minor Road", length_km: 68, condition: "Fair", last_maintained: "2023-07-10", next_maintenance: "2024-05-10", budget_allocated: 210000 },
            { district_id: 6, road_type: "Major Road", length_km: 41, condition: "Good", last_maintained: "2023-12-01", next_maintenance: "2024-09-01", budget_allocated: 185000 }
        ];

        // PERSONNEL DIRECTORY
        const personnel = [
            { id: "PER001", name: "Hon. Alhaji S. Jawara", title: "Regional Governor", department: "Office of The Governor", phone: "+220-1234567", email: "gov.lrr@gov.gm", clearance: "Top Secret", status: "Active" },
            { id: "PER002", name: "Superintendent Lamin Ceesay", title: "Regional Police Commander", department: "Security", phone: "+220-2345678", email: "police.lrr@gov.gm", clearance: "Secret", status: "Active" },
            { id: "PER003", name: "Chief Superintendent Omar Jallow", title: "Regional Immigration Commander", department: "Security", phone: "+220-3456789", email: "immigration.lrr@gov.gm", clearance: "Secret", status: "Active" },
            { id: "PER004", name: "Dr. Fatou B. Njie", title: "Regional Health Director", department: "Health", phone: "+220-4567890", email: "health.lrr@gov.gm", clearance: "Confidential", status: "Active" },
            { id: "PER005", name: "Mr. Ebrima Sanyang", title: "Regional Agriculture Director", department: "Agriculture", phone: "+220-5678901", email: "agric.lrr@gov.gm", clearance: "Confidential", status: "Active" },
            { id: "PER006", name: "Mr. Lamin S. Jatta", title: "Jarra West Council Chairman", department: "Local Government", phone: "+220-6789012", email: "council.jw@gov.gm", clearance: "Confidential", status: "Active" },
            { id: "PER007", name: "Ms. Binta Jallow", title: "Jarra Central Council Chairperson", department: "Local Government", phone: "+220-7890123", email: "council.jc@gov.gm", clearance: "Confidential", status: "Active" },
            { id: "PER008", name: "Commander Fatou N. Manneh", title: "Regional Drug Enforcement Commander", department: "Security", phone: "+220-8901234", email: "druglaw.lrr@gov.gm", clearance: "Secret", status: "Active" },
            { id: "PER009", name: "Chief Fire Officer Modou L. Bah", title: "Regional Fire Commander", department: "Security", phone: "+220-9012345", email: "fire.lrr@gov.gm", clearance: "Confidential", status: "Active" },
            { id: "PER010", name: "Mr. Malick Njie", title: "UNDP Regional Coordinator", department: "Development Partners", phone: "+220-0123456", email: "malick.njie@undp.org", clearance: "Confidential", status: "Active" }
        ];

        // WEEKLY REPORTS SUBMISSIONS
        const weeklyReports = [
            { id: "WR001", department: "Police Command", report_type: "Security", submitted_by: "Supt. Lamin Ceesay", submission_date: "2024-01-22", period: "Jan 15-21, 2024", status: "Submitted", urgency: "High", download_link: "#", summary: "7 incidents reported, 2 critical. Crime down 15% from previous week." },
            { id: "WR002", department: "Health Directorate", report_type: "Health", submitted_by: "Dr. Fatou Njie", submission_date: "2024-01-22", period: "Jan 15-21, 2024", status: "Submitted", urgency: "High", download_link: "#", summary: "156 malaria cases, 3 cholera cases in Tendaba. Drug stock at 75%." },
            { id: "WR003", department: "Agriculture Directorate", report_type: "Agriculture", submitted_by: "Mr. Ebrima Sanyang", submission_date: "2024-01-21", period: "Jan 14-20, 2024", status: "Submitted", urgency: "Medium", download_link: "#", summary: "Rice harvest at 85% completion. Groundnut price at GMD 25.7/kg." },
            { id: "WR004", department: "Jarra West Council", report_type: "Local Government", submitted_by: "Mr. Lamin S. Jatta", submission_date: "2024-01-21", period: "Jan 14-20, 2024", status: "Submitted", urgency: "Medium", download_link: "#", summary: "Revenue collection at 87%. Market rehabilitation 60% complete." },
            { id: "WR005", department: "Immigration Command", report_type: "Security", submitted_by: "Chief Supt. Omar Jallow", submission_date: "2024-01-23", period: "Jan 16-22, 2024", status: "Submitted", urgency: "Medium", download_link: "#", summary: "125 border crossings recorded. 3 irregular movements detected." },
            { id: "WR006", department: "Education Directorate", report_type: "Education", submitted_by: "Mr. Omar Jallow", submission_date: "2024-01-20", period: "Jan 13-19, 2024", status: "Submitted", urgency: "Low", download_link: "#", summary: "School attendance at 94%. Teacher shortage of 12 positions." },
            { id: "WR007", department: "Works Directorate", report_type: "Infrastructure", submitted_by: "Eng. Lamin Ceesay", submission_date: "2024-01-19", period: "Jan 12-18, 2024", status: "Submitted", urgency: "Medium", download_link: "#", summary: "Soma-Mansa Konko road 45% complete. Bridge repairs ongoing." },
            { id: "WR008", department: "Drug Law Enforcement", report_type: "Security", submitted_by: "Commander Fatou Manneh", submission_date: "2024-01-24", period: "Jan 17-23, 2024", status: "Pending", urgency: "High", download_link: "#", summary: "2 drug seizures made. 1 arrest. Awareness campaign in schools." },
            { id: "WR009", department: "Youth & Sports", report_type: "Youth Affairs", submitted_by: "Mr. Yankuba Colley", submission_date: "2024-01-23", period: "Jan 16-22, 2024", status: "Submitted", urgency: "Low", download_link: "#", summary: "Youth football tournament completed. 125 participants." },
            { id: "WR010", department: "Women's Affairs", report_type: "Gender", submitted_by: "Ms. Mariama Sarr", submission_date: "2024-01-22", period: "Jan 15-21, 2024", status: "Submitted", urgency: "Medium", download_link: "#", summary: "Women's entrepreneurship training. 35 participants. 2 GBV cases reported." },
            { id: "WR011", department: "Fire & Rescue Service", report_type: "Security", submitted_by: "Chief Fire Officer Modou Bah", submission_date: "2024-01-26", period: "Jan 19-25, 2024", status: "Late", urgency: "High", download_link: "#", summary: "3 fire incidents. 1 major bush fire in Jiroff contained." },
            { id: "WR012", department: "Jarra Central Council", report_type: "Local Government", submitted_by: "Ms. Fatou B. Njie", submission_date: "2024-01-24", period: "Jan 17-23, 2024", status: "Submitted", urgency: "Medium", download_link: "#", summary: "Revenue collection at 83%. Health center construction 70% complete." }
        ];

        // EMERGENCY ALERTS
        const emergencyAlerts = [
            { id: "ALT001", type: "Security", severity: "High", district: "Jarra West", village: "Soma", message: "Protest planned at Soma Market tomorrow 10AM. Traders association organizing demonstration over market fees.", issued_by: "Police Commander", issue_time: "2024-01-26 18:30", status: "Active", action_required: "Increased police presence, dialogue with traders association", assigned_to: "Supt. Lamin Ceesay" },
            { id: "ALT002", type: "Health", severity: "Critical", district: "Kiang West", village: "Tendaba", message: "Cholera outbreak suspected in Tendaba. 3 confirmed cases, 12 suspected. Water testing shows contamination.", issued_by: "Health Director", issue_time: "2024-01-26 09:15", status: "Active", action_required: "Emergency water supply, medical team deployment, public awareness", assigned_to: "Dr. Fatou Njie" },
            { id: "ALT003", type: "Natural Disaster", severity: "High", district: "Kiang Central", village: "Jiroff", message: "Bush fire spreading toward Jiroff village. 15 hectares burned, threatening 20 homes.", issued_by: "Fire Service", issue_time: "2024-01-25 14:45", status: "Emergency", action_required: "Firefighting teams, community evacuation plan, NDMA coordination", assigned_to: "Chief Fire Officer Modou Bah" }
        ];

        // DEVELOPMENT PARTNERS
        const developmentPartners = [
            { id: "DP001", name: "United Nations Development Programme", acronym: "UNDP", coordinator: "Mr. Malick Njie", contact: "+220-1122334", email: "malick.njie@undp.org", projects: ["Solar Water Project", "Youth Employment", "Governance Support"], funding: 4500000, report_due: "Quarterly progress reports", issues: ["Delayed procurement", "Community engagement"] },
            { id: "DP002", name: "World Food Programme", acronym: "WFP", coordinator: "Ms. Fatou S. Manneh", contact: "+220-2233445", email: "f.manneh@wfp.org", projects: ["School Feeding", "Nutrition Support", "Food for Assets"], funding: 3200000, report_due: "Monthly distribution reports", issues: ["Logistical challenges", "Storage facilities"] },
            { id: "DP003", name: "UNICEF", coordinator: "Dr. Lamin S. Camara", contact: "+220-3344556", email: "l.camara@unicef.org", projects: ["Child Protection", "Education Support", "Health & Nutrition"], funding: 2800000, report_due: "Monthly activity reports", issues: ["Coordination with MOH", "Monitoring visits"] },
            { id: "DP004", name: "International Fund for Agricultural Development", acronym: "IFAD", coordinator: "Mr. Ebrima Sanyang", contact: "+220-4455667", email: "e.sanyang@ifad.org", projects: ["Rice Irrigation Scheme", "Agricultural Value Chains"], funding: 8900000, report_due: "Semi-annual progress reports", issues: ["Climate variability", "Farmer training"] },
            { id: "DP005", name: "European Union", acronym: "EU", coordinator: "Ms. Mariama Sarr", contact: "+220-5566778", email: "m.sarr@eeas.europa.eu", projects: ["Health Center Construction", "Road Rehabilitation"], funding: 5800000, report_due: "Annual implementation reports", issues: ["Contractor performance", "Environmental compliance"] }
        ];

        // ==============================================
        // AUTO-CALCULATION FUNCTIONS
        // ==============================================
        
        function calculateMetrics() {
            // Calculate security metrics
            const criticalIncidents = securityIncidents.filter(i => i.severity === "Critical" || i.severity === "High").length;
            const totalIncidents = securityIncidents.length;
            const resolvedIncidents = securityIncidents.filter(i => i.status === "Resolved" || i.status === "Investigation Complete").length;
            const incidentResolvedRate = totalIncidents > 0 ? Math.round((resolvedIncidents / totalIncidents) * 100) : 100;
            
            // Calculate report metrics
            const pendingReports = weeklyReports.filter(r => r.status === "Pending" || r.status === "Late").length;
            const submittedReports = weeklyReports.filter(r => r.status === "Submitted").length;
            const totalReports = weeklyReports.length;
            const reportCompletionRate = Math.round((submittedReports / totalReports) * 100);
            
            // Calculate financial metrics
            const totalRevenueTarget = councilPerformance.reduce((sum, council) => sum + council.revenue_target, 0);
            const totalRevenueCollected = councilPerformance.reduce((sum, council) => sum + council.revenue_collected, 0);
            const revenueCollectionRate = Math.round((totalRevenueCollected / totalRevenueTarget) * 100);
            
            // Calculate project metrics
            const totalProjects = developmentProjects.length;
            const completedProjects = developmentProjects.filter(p => p.physical_completion >= 90).length;
            const averageCompletion = Math.round(developmentProjects.reduce((sum, project) => sum + project.physical_completion, 0) / totalProjects);
            
            // Calculate health metrics
            const totalMalariaCases = healthData.reduce((sum, district) => sum + district.malaria_cases, 0);
            const totalCholeraCases = healthData.reduce((sum, district) => sum + district.cholera_cases, 0);
            const averageVaccinationRate = Math.round(healthData.reduce((sum, district) => sum + district.vaccination_rate, 0) / healthData.length);
            
            // Calculate education metrics
            const totalStudents = educationData.reduce((sum, school) => sum + school.student_enrollment, 0);
            const totalTeachers = educationData.reduce((sum, school) => sum + school.teacher_count, 0);
            const averagePassRate = Math.round(educationData.reduce((sum, school) => sum + school.pass_rate, 0) / educationData.length);
            const averageAttendanceRate = Math.round(educationData.reduce((sum, school) => sum + school.attendance_rate, 0) / educationData.length);
            
            // Calculate agriculture metrics
            const totalRiceProduction = agricultureData.filter(c => c.crop_type === "Rice").reduce((sum, crop) => sum + crop.production_tons, 0);
            const totalGroundnutProduction = agricultureData.filter(c => c.crop_type === "Groundnuts").reduce((sum, crop) => sum + crop.production_tons, 0);
            const averageRainfall = Math.round(agricultureData.reduce((sum, crop) => sum + crop.rainfall_mm, 0) / agricultureData.length);
            
            // Calculate infrastructure metrics
            const totalRoadLength = infrastructureData.reduce((sum, road) => sum + road.length_km, 0);
            const roadsNeedingRepair = infrastructureData.filter(road => road.condition === "Poor" || road.condition === "Fair").length;
            
            return {
                securityIndex: Math.max(0, 100 - (criticalIncidents * 5)),
                incidentResolvedRate: incidentResolvedRate,
                reportCompletionRate: reportCompletionRate,
                criticalAlerts: criticalIncidents,
                pendingActions: pendingReports,
                revenueCollection: revenueCollectionRate,
                projectCompletion: averageCompletion,
                healthReadiness: Math.round((averageVaccinationRate * 0.7) + ((100 - (totalMalariaCases / 10)) * 0.3)),
                educationPerformance: Math.round((averagePassRate * 0.4) + (averageAttendanceRate * 0.4) + ((totalTeachers / (totalStudents / 40)) * 20)),
                totalRevenueCollected: totalRevenueCollected,
                totalProjects: totalProjects,
                completedProjects: completedProjects,
                totalMalariaCases: totalMalariaCases,
                totalCholeraCases: totalCholeraCases,
                totalStudents: totalStudents,
                totalTeachers: totalTeachers,
                totalRiceProduction: totalRiceProduction,
                totalGroundnutProduction: totalGroundnutProduction,
                totalRoadLength: totalRoadLength,
                roadsNeedingRepair: roadsNeedingRepair
            };
        }

        // ==============================================
        // ENHANCED SECURITY FUNCTIONS
        // ==============================================
        
        function showNotification(type, title, message) {
            const notification = document.getElementById('notification');
            const titleEl = document.getElementById('notificationTitle');
            const messageEl = document.getElementById('notificationMessage');
            const icon = notification.querySelector('.notification-icon i');
            
            notification.className = `notification notification-${type}`;
            titleEl.textContent = title;
            messageEl.textContent = message;
            
            switch(type) {
                case 'success':
                    icon.className = 'fas fa-check';
                    break;
                case 'error':
                    icon.className = 'fas fa-exclamation-circle';
                    break;
                case 'info':
                    icon.className = 'fas fa-info-circle';
                    break;
            }
            
            notification.classList.add('show');
            setTimeout(() => notification.classList.remove('show'), 5000);
        }

        function hideNotification() {
            document.getElementById('notification').classList.remove('show');
        }

        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        function resetSessionTimer() {
            clearTimeout(logoutTimer);
            logoutTimer = setTimeout(logout, SESSION_TIMEOUT);
        }

        // ==============================================
        // LOGIN SYSTEM
        // ==============================================
        
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            login();
        });

        document.getElementById('togglePassword').addEventListener('click', function() {
            const passwordInput = document.getElementById('password');
            const icon = this.querySelector('i');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.className = 'fas fa-eye-slash';
            } else {
                passwordInput.type = 'password';
                icon.className = 'fas fa-eye';
            }
        });

        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorElement = document.getElementById('loginError');
            const loginButton = document.getElementById('loginButton');
            
            // Show loading state
            loginButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Authenticating...';
            loginButton.disabled = true;
            
            // Simulate API call delay
            setTimeout(() => {
                // In production, this would be a secure server-side check
                const encryptedInput = btoa(password);
                
                // Check credentials (in production, use secure server authentication)
                if (username.toLowerCase() === 'governor' && encryptedInput === ENCRYPTED_PASSWORD) {
                    // Successful login
                    dashboardData.lastLogin = new Date().toISOString();
                    dashboardData.sessionStart = new Date().toISOString();
                    dashboardData.accessLog.push({
                        timestamp: new Date().toISOString(),
                        action: 'login',
                        success: true
                    });
                    
                    // Store session data
                    sessionStorage.setItem('governorSession', JSON.stringify({
                        authenticated: true,
                        sessionStart: new Date().toISOString(),
                        user: 'Hon. Alhaji S. Jawara'
                    }));
                    
                    // Hide login, show dashboard
                    document.getElementById('loginContainer').style.display = 'none';
                    document.getElementById('dashboardContainer').style.display = 'block';
                    
                    // Initialize dashboard
                    initializeDashboard();
                    
                    // Start session timer
                    resetSessionTimer();
                    
                    // Log activity
                    showNotification('success', 'Login Successful', 'Welcome to Governor\'s Command Center');
                } else {
                    // Failed login
                    errorElement.style.display = 'block';
                    loginButton.innerHTML = '<i class="fas fa-lock"></i> Secure Login';
                    loginButton.disabled = false;
                    
                    // Log failed attempt
                    dashboardData.accessLog.push({
                        timestamp: new Date().toISOString(),
                        action: 'login',
                        success: false,
                        username: username
                    });
                    
                    showNotification('error', 'Authentication Failed', 'Invalid credentials');
                }
            }, 1000); // Simulated delay
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                // Clear session
                sessionStorage.removeItem('governorSession');
                
                // Reset login form
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                document.getElementById('loginError').style.display = 'none';
                document.getElementById('loginButton').innerHTML = '<i class="fas fa-lock"></i> Secure Login';
                document.getElementById('loginButton').disabled = false;
                
                // Show login, hide dashboard
                document.getElementById('dashboardContainer').style.display = 'none';
                document.getElementById('loginContainer').style.display = 'flex';
                
                // Clear timer
                clearTimeout(logoutTimer);
                
                showNotification('info', 'Session Ended', 'You have been logged out successfully');
            }
        }

        // ==============================================
        // DASHBOARD INITIALIZATION
        // ==============================================
        
        function initializeDashboard() {
            // Initialize navigation
            initNavigation();
            
            // Initialize interactive map
            initMap();
            
            // Populate all data
            populateMetricCards();
            populateRecentAlerts();
            populateIncidentsTable();
            populateReportsTable();
            populateExportOptions();
            
            // Update alert count
            updateAlertCount();
            
            // Set up event listeners
            setupEventListeners();
            
            // Start auto-refresh for real-time data
            startAutoRefresh();
        }

        function initNavigation() {
            // Main navigation links
            const navLinks = document.querySelectorAll('.nav-link:not(.dropdown-toggle)');
            const sections = document.querySelectorAll('.dashboard-section');
            
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remove active class from all links
                    navLinks.forEach(nav => nav.classList.remove('active'));
                    
                    // Add active class to clicked link
                    this.classList.add('active');
                    
                    // Hide all sections
                    sections.forEach(section => section.classList.remove('active'));
                    
                    // Show selected section
                    const sectionId = this.getAttribute('data-section');
                    document.getElementById(sectionId).classList.add('active');
                    
                    // Update breadcrumb
                    updateBreadcrumb(this.textContent.trim());
                    
                    // Reset session timer
                    resetSessionTimer();
                    
                    // Close mobile menu if open
                    if (window.innerWidth <= 1200) {
                        document.getElementById('sidebar').classList.remove('active');
                    }
                });
            });
            
            // Dropdown toggles
            const dropdownToggles = document.querySelectorAll('.dropdown-toggle');
            dropdownToggles.forEach(toggle => {
                toggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const targetId = this.getAttribute('data-toggle');
                    const dropdown = document.getElementById(`${targetId}-dropdown`);
                    
                    // Toggle current dropdown
                    dropdown.classList.toggle('show');
                    this.classList.toggle('active');
                    
                    // Close other dropdowns
                    document.querySelectorAll('.nav-dropdown').forEach(d => {
                        if (d !== dropdown) {
                            d.classList.remove('show');
                            d.previousElementSibling.classList.remove('active');
                        }
                    });
                    
                    resetSessionTimer();
                });
            });
            
            // Dropdown items
            const dropdownItems = document.querySelectorAll('.dropdown-item');
            dropdownItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const sectionId = this.getAttribute('data-section');
                    const sections = document.querySelectorAll('.dashboard-section');
                    
                    // Hide all sections
                    sections.forEach(section => section.classList.remove('active'));
                    
                    // Show selected section
                    if (document.getElementById(sectionId)) {
                        document.getElementById(sectionId).classList.add('active');
                        
                        // Update navigation
                        navLinks.forEach(link => link.classList.remove('active'));
                        
                        // Update breadcrumb
                        const parentText = this.closest('.nav-item').querySelector('.nav-link').textContent.trim();
                        updateBreadcrumb(`${parentText} / ${this.textContent.trim()}`);
                        
                        // Close dropdown
                        document.querySelectorAll('.nav-dropdown').forEach(d => d.classList.remove('show'));
                        document.querySelectorAll('.dropdown-toggle').forEach(t => t.classList.remove('active'));
                        
                        resetSessionTimer();
                    }
                });
            });
            
            // Close dropdowns when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.nav-item')) {
                    document.querySelectorAll('.nav-dropdown').forEach(d => d.classList.remove('show'));
                    document.querySelectorAll('.dropdown-toggle').forEach(t => t.classList.remove('active'));
                }
            });
            
            // Mobile menu toggle
            document.getElementById('mobileMenuToggle').addEventListener('click', function() {
                document.getElementById('sidebar').classList.toggle('active');
            });
        }

        function updateBreadcrumb(text) {
            const breadcrumb = document.getElementById('breadcrumb');
            const activeItem = breadcrumb.querySelector('.breadcrumb-item.active');
            
            if (activeItem) {
                activeItem.textContent = text;
            }
        }

        function showSection(sectionId) {
            const sections = document.querySelectorAll('.dashboard-section');
            const navLinks = document.querySelectorAll('.nav-link:not(.dropdown-toggle)');
            
            // Hide all sections
            sections.forEach(section => section.classList.remove('active'));
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Update navigation
            navLinks.forEach(link => link.classList.remove('active'));
            
            // Find and activate corresponding nav link
            const targetLink = document.querySelector(`.nav-link[data-section="${sectionId}"]`);
            if (targetLink) {
                targetLink.classList.add('active');
            }
            
            // Update breadcrumb
            if (targetLink) {
                updateBreadcrumb(targetLink.textContent.trim());
            }
            
            resetSessionTimer();
        }

        function toggleUserMenu() {
            document.getElementById('userMenuDropdown').classList.toggle('show');
        }

        // Close user menu when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.user-menu')) {
                document.getElementById('userMenuDropdown').classList.remove('show');
            }
        });

        // ==============================================
        // DATA POPULATION FUNCTIONS
        // ==============================================
        
        function populateMetricCards() {
            const metrics = calculateMetrics();
            const container = document.getElementById('metricCards');
            
            const cards = [
                {
                    title: "Security Index",
                    value: `${metrics.securityIndex}/100`,
                    icon: "fas fa-shield-alt",
                    color: "var(--info)",
                    trend: metrics.securityIndex > 75 ? "up" : "down",
                    trendValue: `${metrics.securityIndex > 75 ? "+" : "-"}2%`,
                    footer: `${metrics.criticalAlerts} critical incidents`
                },
                {
                    title: "Revenue Collection",
                    value: `${metrics.revenueCollection}%`,
                    icon: "fas fa-money-bill-wave",
                    color: "var(--success)",
                    trend: "up",
                    trendValue: `GMD ${Math.round(metrics.totalRevenueCollected/1000000)}M collected`,
                    footer: `${metrics.revenueCollection > 85 ? "Exceeding" : "Meeting"} target`
                },
                {
                    title: "Project Completion",
                    value: `${metrics.projectCompletion}%`,
                    icon: "fas fa-hard-hat",
                    color: "var(--warning)",
                    trend: "up",
                    trendValue: `${metrics.completedProjects}/${metrics.totalProjects} projects`,
                    footer: `${metrics.averageCompletion > 70 ? "On track" : "Needs attention"}`
                },
                {
                    title: "Health Readiness",
                    value: `${metrics.healthReadiness}/100`,
                    icon: "fas fa-hospital",
                    color: "var(--danger)",
                    trend: metrics.totalMalariaCases > 150 ? "down" : "up",
                    trendValue: `${metrics.totalMalariaCases} malaria cases`,
                    footer: `${metrics.totalCholeraCases > 0 ? "Cholera alert" : "Stable situation"}`
                },
                {
                    title: "Report Compliance",
                    value: `${metrics.reportCompletionRate}%`,
                    icon: "fas fa-file-alt",
                    color: "var(--purple)",
                    trend: "up",
                    trendValue: `${metrics.pendingActions} pending reports`,
                    footer: `${metrics.reportCompletionRate > 80 ? "Good" : "Needs improvement"}`
                },
                {
                    title: "Education Performance",
                    value: `${metrics.educationPerformance}/100`,
                    icon: "fas fa-graduation-cap",
                    color: "var(--primary-gold)",
                    trend: "up",
                    trendValue: `${metrics.totalStudents.toLocaleString()} students`,
                    footer: `${metrics.totalTeachers} teachers (1:${Math.round(metrics.totalStudents/metrics.totalTeachers)})`
                }
            ];
            
            container.innerHTML = cards.map(card => `
                <div class="metric-card" style="border-top-color: ${card.color}">
                    <div class="metric-card-header">
                        <div class="metric-title">${card.title}</div>
                        <div class="metric-icon" style="background: ${card.color}20; color: ${card.color}">
                            <i class="${card.icon}"></i>
                        </div>
                    </div>
                    <div class="metric-value" style="color: ${card.color}">${card.value}</div>
                    <div class="metric-trend">
                        <i class="fas fa-arrow-${card.trend} ${card.trend === 'up' ? 'trend-up' : 'trend-down'}"></i>
                        <span class="${card.trend === 'up' ? 'trend-up' : 'trend-down'}">${card.trendValue}</span>
                    </div>
                    <div class="metric-footer">
                        <span>${card.footer}</span>
                        <button class="table-btn" onclick="showSection('${card.title.toLowerCase().includes('security') ? 'incidents' : card.title.toLowerCase().includes('revenue') ? 'revenue' : card.title.toLowerCase().includes('project') ? 'projects' : 'reports'}')">
                            <i class="fas fa-chart-bar"></i> Details
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function populateRecentAlerts() {
            const container = document.getElementById('recentAlerts');
            const recentAlerts = emergencyAlerts.slice(0, 3);
            
            container.innerHTML = recentAlerts.map(alert => {
                let alertClass = 'alert-medium';
                if (alert.severity === 'Critical') alertClass = 'alert-critical';
                if (alert.severity === 'High') alertClass = 'alert-high';
                
                return `
                    <div class="alert-item ${alertClass}">
                        <div class="alert-icon-container">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="alert-content">
                            <div class="alert-header">
                                <div class="alert-title">${alert.type} Alert in ${alert.district}</div>
                                <div class="alert-time">${alert.issue_time}</div>
                            </div>
                            <div class="alert-description">
                                ${alert.message}
                            </div>
                            <div class="alert-actions">
                                <button class="table-btn" onclick="viewAlertDetails('${alert.id}')">
                                    <i class="fas fa-eye"></i> View
                                </button>
                                <button class="table-btn" onclick="acknowledgeAlert('${alert.id}')">
                                    <i class="fas fa-check"></i> Acknowledge
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function populateIncidentsTable() {
            const tbody = document.getElementById('incidentsTableBody');
            
            tbody.innerHTML = securityIncidents.map(incident => {
                let statusClass = 'status-active';
                if (incident.status === 'Under Investigation') statusClass = 'status-pending';
                if (incident.status === 'Emergency Response') statusClass = 'status-critical';
                if (incident.status === 'Search Ongoing') statusClass = 'status-pending';
                
                let severityClass = 'status-active';
                if (incident.severity === 'High') severityClass = 'status-pending';
                if (incident.severity === 'Critical') severityClass = 'status-critical';
                if (incident.severity === 'Medium') severityClass = 'status-active';
                if (incident.severity === 'Low') severityClass = 'status-completed';
                
                return `
                    <tr>
                        <td><strong>${incident.id}</strong></td>
                        <td>${incident.date}</td>
                        <td>${incident.district}</td>
                        <td>${incident.type}</td>
                        <td><span class="status-badge ${severityClass}">${incident.severity}</span></td>
                        <td><span class="status-badge ${statusClass}">${incident.status}</span></td>
                        <td>
                            <div class="table-actions">
                                <button class="table-btn" onclick="viewIncident('${incident.id}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="table-btn" onclick="exportIncidentCSV('${incident.id}')">
                                    <i class="fas fa-download"></i>
                                </button>
                                <button class="table-btn" onclick="updateIncidentStatus('${incident.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function populateReportsTable() {
            const tbody = document.getElementById('reportsTableBody');
            
            tbody.innerHTML = weeklyReports.map(report => {
                let statusClass = 'status-active';
                if (report.status === 'Pending') statusClass = 'status-pending';
                if (report.status === 'Late') statusClass = 'status-critical';
                
                return `
                    <tr>
                        <td><strong>${report.department}</strong></td>
                        <td>${report.report_type} Report</td>
                        <td>${report.submission_date}</td>
                        <td>${report.submitted_by}</td>
                        <td><span class="status-badge ${statusClass}">${report.status}</span></td>
                        <td>
                            <div class="table-actions">
                                <button class="table-btn" onclick="downloadReport('${report.department}')">
                                    <i class="fas fa-download"></i> Download
                                </button>
                                <button class="table-btn" onclick="viewReportDetails('${report.department}')">
                                    <i class="fas fa-info-circle"></i> Details
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function populateExportOptions() {
            const options = [
                { id: 'incidents', name: 'Security Incidents', icon: 'fas fa-shield-alt', description: 'All security incidents with details' },
                { id: 'reports', name: 'Department Reports', icon: 'fas fa-file-alt', description: 'All departmental reports and status' },
                { id: 'finance', name: 'Financial Data', icon: 'fas fa-money-bill-wave', description: 'Revenue collection and expenditure' },
                { id: 'projects', name: 'Development Projects', icon: 'fas fa-hard-hat', description: 'Active development projects tracking' },
                { id: 'health', name: 'Health Statistics', icon: 'fas fa-hospital', description: 'Disease surveillance and health metrics' },
                { id: 'education', name: 'Education Data', icon: 'fas fa-graduation-cap', description: 'School performance and attendance' },
                { id: 'agriculture', name: 'Agricultural Data', icon: 'fas fa-tractor', description: 'Crop production and market prices' },
                { id: 'councils', name: 'Council Performance', icon: 'fas fa-landmark', description: 'Area council financial performance' },
                { id: 'personnel', name: 'Personnel Directory', icon: 'fas fa-users', description: 'Government officials and contacts' },
                { id: 'alerts', name: 'Emergency Alerts', icon: 'fas fa-exclamation-triangle', description: 'All emergency alerts and status' },
                { id: 'traditional-leaders', name: 'Traditional Leaders', icon: 'fas fa-crown', description: 'Seyfos and Alkalos directory' },
                { id: 'development-partners', name: 'Development Partners', icon: 'fas fa-handshake', description: 'NGOs and UN agencies' }
            ];
            
            // Populate main export section
            const mainContainer = document.getElementById('exportOptions');
            mainContainer.innerHTML = options.map(option => `
                <div class="export-option" onclick="exportDataset('${option.id}')">
                    <i class="${option.icon}"></i>
                    <h3>${option.name}</h3>
                    <p>${option.description}</p>
                </div>
            `).join('');
            
            // Populate modal export options
            const modalContainer = document.getElementById('modalExportOptions');
            modalContainer.innerHTML = options.map(option => `
                <div class="export-option" onclick="exportDataset('${option.id}')">
                    <i class="${option.icon}"></i>
                    <h3>${option.name}</h3>
                    <p>${option.description}</p>
                </div>
            `).join('');
        }

        // ==============================================
        // ENHANCED CSV EXPORT FUNCTIONS
        // ==============================================
        
        function exportToCSV(datasetId) {
            showLoading();
            
            setTimeout(() => {
                let data = [];
                let filename = '';
                
                switch(datasetId) {
                    case 'incidents':
                        data = securityIncidents;
                        filename = 'security_incidents_lrr.csv';
                        break;
                    case 'reports':
                        data = weeklyReports;
                        filename = 'department_reports_lrr.csv';
                        break;
                    case 'finance':
                        data = councilPerformance;
                        filename = 'financial_data_lrr.csv';
                        break;
                    case 'projects':
                        data = developmentProjects;
                        filename = 'development_projects_lrr.csv';
                        break;
                    case 'health':
                        data = healthData;
                        filename = 'health_statistics_lrr.csv';
                        break;
                    case 'education':
                        data = educationData;
                        filename = 'education_data_lrr.csv';
                        break;
                    case 'agriculture':
                        data = agricultureData;
                        filename = 'agricultural_data_lrr.csv';
                        break;
                    case 'councils':
                        data = councilPerformance;
                        filename = 'council_performance_lrr.csv';
                        break;
                    case 'personnel':
                        data = personnel;
                        filename = 'personnel_directory_lrr.csv';
                        break;
                    case 'alerts':
                        data = emergencyAlerts;
                        filename = 'emergency_alerts_lrr.csv';
                        break;
                    case 'traditional-leaders':
                        data = [...seyfos, ...villages.map(v => ({
                            type: 'Alkalos',
                            name: v.alkalos_name,
                            district: districts.find(d => d.id === v.district_id)?.name,
                            village: v.name,
                            contact: v.contact
                        }))];
                        filename = 'traditional_leaders_lrr.csv';
                        break;
                    case 'development-partners':
                        data = developmentPartners;
                        filename = 'development_partners_lrr.csv';
                        break;
                }
                
                if (data.length > 0) {
                    const csv = convertToCSV(data);
                    downloadFile(csv, filename);
                    showNotification('success', 'Export Successful', `${filename} downloaded successfully`);
                } else {
                    showNotification('error', 'Export Failed', 'No data available for export');
                }
                
                hideLoading();
            }, 1000);
        }

        function exportToExcel(datasetId) {
            showLoading();
            
            setTimeout(() => {
                let data = [];
                let filename = '';
                
                switch(datasetId) {
                    case 'incidents':
                        data = securityIncidents;
                        filename = 'security_incidents_lrr.xlsx';
                        break;
                    case 'reports':
                        data = weeklyReports;
                        filename = 'department_reports_lrr.xlsx';
                        break;
                    default:
                        data = securityIncidents;
                        filename = 'export_lrr.xlsx';
                }
                
                if (data.length > 0) {
                    const worksheet = XLSX.utils.json_to_sheet(data);
                    const workbook = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(workbook, worksheet, "Data");
                    XLSX.writeFile(workbook, filename);
                    showNotification('success', 'Export Successful', `${filename} downloaded successfully`);
                } else {
                    showNotification('error', 'Export Failed', 'No data available for export');
                }
                
                hideLoading();
            }, 1000);
        }

        function exportDataset(datasetId) {
            const format = prompt('Select export format:\n1. CSV\n2. Excel\n3. JSON\n\nEnter 1, 2, or 3:', '1');
            
            if (format === '1') {
                exportToCSV(datasetId);
            } else if (format === '2') {
                exportToExcel(datasetId);
            } else if (format === '3') {
                exportToJSON(datasetId);
            } else {
                showNotification('error', 'Export Cancelled', 'Please select a valid format');
            }
        }

        function exportToJSON(datasetId) {
            showLoading();
            
            setTimeout(() => {
                let data = [];
                let filename = '';
                
                switch(datasetId) {
                    case 'incidents':
                        data = securityIncidents;
                        filename = 'security_incidents_lrr.json';
                        break;
                    case 'reports':
                        data = weeklyReports;
                        filename = 'department_reports_lrr.json';
                        break;
                    default:
                        data = securityIncidents;
                        filename = 'export_lrr.json';
                }
                
                const json = JSON.stringify(data, null, 2);
                downloadFile(json, filename, 'application/json');
                showNotification('success', 'Export Successful', `${filename} downloaded successfully`);
                
                hideLoading();
            }, 1000);
        }

        function downloadMapCSV() {
            const mapData = securityIncidents.map(incident => ({
                ID: incident.id,
                Date: incident.date,
                District: incident.district,
                Village: incident.village,
                Type: incident.type,
                Severity: incident.severity,
                Status: incident.status,
                Description: incident.description
            }));
            
            const csv = convertToCSV(mapData);
            downloadFile(csv, 'regional_map_data_lrr.csv');
            showNotification('success', 'Map Data Exported', 'Map data downloaded as CSV');
        }

        function exportIncidentCSV(incidentId) {
            const incident = securityIncidents.find(i => i.id === incidentId);
            if (incident) {
                const data = [incident];
                const csv = convertToCSV(data);
                downloadFile(csv, `incident_${incidentId}.csv`);
                showNotification('success', 'Incident Exported', 'Incident data downloaded');
            }
        }

        function downloadReport(department) {
            const report = weeklyReports.find(r => r.department === department);
            if (report) {
                const data = [report];
                const csv = convertToCSV(data);
                downloadFile(csv, `${department.replace(/\s+/g, '_')}_report.csv`);
                showNotification('success', 'Report Downloaded', `${department} report downloaded`);
            } else {
                showNotification('error', 'Report Not Available', 'Report has not been submitted yet');
            }
        }

        // ==============================================
        // UTILITY FUNCTIONS
        // ==============================================
        
        function convertToCSV(objArray) {
            if (objArray.length === 0) return '';
            
            const array = typeof objArray !== 'object' ? JSON.parse(objArray) : objArray;
            let str = '';
            
            // Headers
            const headers = Object.keys(array[0]);
            str += headers.join(',') + '\r\n';
            
            // Data rows
            for (let i = 0; i < array.length; i++) {
                let line = '';
                for (let j = 0; j < headers.length; j++) {
                    if (line !== '') line += ',';
                    const value = array[i][headers[j]];
                    line += value !== null && value !== undefined ? `"${value.toString().replace(/"/g, '""')}"` : '""';
                }
                str += line + '\r\n';
            }
            
            return str;
        }

        function downloadFile(content, filename, contentType = 'text/csv;charset=utf-8;') {
            const blob = new Blob([content], { type: contentType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // ==============================================
        // MAP FUNCTIONS
        // ==============================================
        
        function initMap() {
            // Initialize map centered on Lower River Region
            const map = L.map('region-map').setView([13.4167, -15.55], 10);
            
            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap contributors'
            }).addTo(map);
            
            // Add incident markers
            securityIncidents.forEach(incident => {
                const lat = 13.4167 + (Math.random() - 0.5) * 0.1;
                const lng = -15.55 + (Math.random() - 0.5) * 0.2;
                
                let iconColor;
                if (incident.severity === 'Critical') iconColor = '#F44336';
                else if (incident.severity === 'High') iconColor = '#FF9800';
                else if (incident.severity === 'Medium') iconColor = '#FFC107';
                else iconColor = '#4CAF50';
                
                const icon = L.divIcon({
                    className: 'incident-marker',
                    html: `<div style="background-color: ${iconColor}; width: 20px; height: 20px; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 5px rgba(0,0,0,0.5);"></div>`,
                    iconSize: [20, 20]
                });
                
                const marker = L.marker([lat, lng], { icon: icon }).addTo(map);
                marker.bindPopup(`
                    <strong>${incident.type}</strong><br>
                    <strong>Severity:</strong> ${incident.severity}<br>
                    <strong>Date:</strong> ${incident.date}<br>
                    <strong>Location:</strong> ${incident.district} - ${incident.village}<br>
                    <strong>Status:</strong> ${incident.status}<br>
                    <button class="table-btn" style="margin-top: 10px; padding: 5px 10px;" onclick="viewIncident('${incident.id}')">View Details</button>
                `);
            });
        }

        function refreshMap() {
            showLoading();
            setTimeout(() => {
                document.getElementById('region-map').innerHTML = '';
                initMap();
                hideLoading();
                showNotification('success', 'Map Refreshed', 'Regional map has been updated');
            }, 1000);
        }

        // ==============================================
        // ACTION FUNCTIONS
        // ==============================================
        
        function viewIncident(incidentId) {
            const incident = securityIncidents.find(i => i.id === incidentId);
            if (incident) {
                alert(`Incident Details:\n\nID: ${incident.id}\nDate: ${incident.date}\nTime: ${incident.time}\nDistrict: ${incident.district}\nVillage: ${incident.village}\nType: ${incident.type}\nSeverity: ${incident.severity}\nStatus: ${incident.status}\n\nDescription:\n${incident.description}\n\nAction Taken:\n${incident.action_taken}\n\nReported by: ${incident.reported_by}\nOfficer in charge: ${incident.officer}`);
            }
        }

        function updateIncidentStatus(incidentId) {
            const incident = securityIncidents.find(i => i.id === incidentId);
            if (incident) {
                const newStatus = prompt(`Update status for incident ${incidentId}:`, incident.status);
                if (newStatus) {
                    incident.status = newStatus;
                    populateIncidentsTable();
                    populateRecentAlerts();
                    showNotification('success', 'Status Updated', `Incident ${incidentId} status updated to ${newStatus}`);
                }
            }
        }

        function viewReportDetails(department) {
            const report = weeklyReports.find(r => r.department === department);
            if (report) {
                alert(`Report Details:\n\nDepartment: ${report.department}\nReport Type: ${report.report_type}\nSubmitted by: ${report.submitted_by}\nSubmission date: ${report.submission_date}\nReporting period: ${report.period}\nStatus: ${report.status}\nUrgency: ${report.urgency}\n\nSummary:\n${report.summary}`);
            }
        }

        function viewAlertDetails(alertId) {
            const alert = emergencyAlerts.find(a => a.id === alertId);
            if (alert) {
                alert(`Alert Details:\n\nID: ${alert.id}\nType: ${alert.type}\nSeverity: ${alert.severity}\nDistrict: ${alert.district}\nVillage: ${alert.village}\nStatus: ${alert.status}\n\nMessage:\n${alert.message}\n\nAction Required:\n${alert.action_required}\n\nAssigned to: ${alert.assigned_to}\nIssued by: ${alert.issued_by}\nIssue time: ${alert.issue_time}`);
            }
        }

        function acknowledgeAlert(alertId) {
            const alertIndex = emergencyAlerts.findIndex(a => a.id === alertId);
            if (alertIndex !== -1) {
                emergencyAlerts[alertIndex].status = 'Acknowledged';
                populateRecentAlerts();
                updateAlertCount();
                showNotification('success', 'Alert Acknowledged', 'Alert has been acknowledged');
            }
        }

        function sendReminders() {
            const pending = weeklyReports.filter(r => r.status === 'Pending' || r.status === 'Late');
            showNotification('info', 'Reminders Sent', `Reminders sent to ${pending.length} departments`);
        }

        function addNewIncident() {
            const newIncident = {
                id: `SEC-2024-${String(securityIncidents.length + 1).padStart(3, '0')}`,
                date: new Date().toISOString().split('T')[0],
                time: new Date().toLocaleTimeString(),
                district: prompt('District:'),
                village: prompt('Village:'),
                type: prompt('Incident Type:'),
                severity: prompt('Severity (Low/Medium/High/Critical):'),
                status: 'Reported',
                reported_by: "Governor's Office",
                description: prompt('Description:'),
                action_taken: 'To be determined',
                officer: 'Governor'
            };
            
            if (newIncident.district && newIncident.village && newIncident.type) {
                securityIncidents.unshift(newIncident);
                populateIncidentsTable();
                populateRecentAlerts();
                updateAlertCount();
                
                showNotification('success', 'Incident Added', `New incident ${newIncident.id} has been recorded`);
                showSection('incidents');
            }
        }

        function updateAlertCount() {
            const criticalAlerts = emergencyAlerts.filter(a => a.severity === 'Critical' || a.severity === 'High').length;
            document.getElementById('alertCount').textContent = criticalAlerts;
        }

        function generateWeeklyReport() {
            showLoading();
            
            setTimeout(() => {
                const reportDate = new Date().toISOString().split('T')[0];
                const metrics = calculateMetrics();
                
                const report = `
                    GOVERNOR'S WEEKLY BRIEFING REPORT
                    =================================
                    Lower River Region, The Gambia
                    Date: ${reportDate}
                    Classification: CONFIDENTIAL
                    
                    EXECUTIVE SUMMARY
                    -----------------
                    Security Index: ${metrics.securityIndex}/100
                    Revenue Collection: ${metrics.revenueCollection}% (GMD ${Math.round(metrics.totalRevenueCollected/1000000)}M)
                    Project Completion: ${metrics.projectCompletion}%
                    Health Readiness: ${metrics.healthReadiness}/100
                    
                    CRITICAL INCIDENTS: ${metrics.criticalAlerts}
                    PENDING REPORTS: ${metrics.pendingActions}
                    
                    DETAILED ANALYSIS:
                    -----------------
                    SECURITY:
                    - Total incidents: ${securityIncidents.length}
                    - Critical incidents: ${metrics.criticalAlerts}
                    - Incident resolution rate: ${metrics.incidentResolvedRate}%
                    
                    FINANCE:
                    - Total revenue collected: GMD ${metrics.totalRevenueCollected.toLocaleString()}
                    - Collection rate: ${metrics.revenueCollection}%
                    - Top performing council: Jarra West (87%)
                    
                    DEVELOPMENT:
                    - Active projects: ${metrics.totalProjects}
                    - Projects nearing completion: ${metrics.completedProjects}
                    - Average completion: ${metrics.projectCompletion}%
                    
                    HEALTH:
                    - Malaria cases: ${metrics.totalMalariaCases}
                    - Cholera cases: ${metrics.totalCholeraCases}
                    - Vaccination rate: ${metrics.healthReadiness}%
                    
                    EDUCATION:
                    - Total students: ${metrics.totalStudents.toLocaleString()}
                    - Total teachers: ${metrics.totalTeachers}
                    - Student-teacher ratio: 1:${Math.round(metrics.totalStudents/metrics.totalTeachers)}
                    - Average pass rate: ${metrics.educationPerformance}%
                    
                    AGRICULTURE:
                    - Rice production: ${metrics.totalRiceProduction.toLocaleString()} tons
                    - Groundnut production: ${metrics.totalGroundnutProduction.toLocaleString()} tons
                    
                    INFRASTRUCTURE:
                    - Total road network: ${metrics.totalRoadLength} km
                    - Roads needing repair: ${metrics.roadsNeedingRepair}
                    
                    CRITICAL ISSUES:
                    -----------------
                    1. ${emergencyAlerts[0]?.message || 'No critical alerts'}
                    2. ${metrics.totalCholeraCases > 0 ? 'Cholera outbreak detected' : 'Health situation stable'}
                    3. ${metrics.revenueCollection < 85 ? 'Revenue collection below target' : 'Revenue collection on target'}
                    
                    RECOMMENDATIONS:
                    -----------------
                    1. Increase police patrols in areas with high incident rates
                    2. Expedite project completion for delayed projects
                    3. Address revenue collection gaps in underperforming councils
                    4. Strengthen disease surveillance and response
                    
                    PREPARED FOR:
                    Office of the President
                    Republic of The Gambia
                    
                    GENERATED BY:
                    Hon. Alhaji S. Jawara
                    Regional Governor, Lower River Region
                    
                    GENERATED: ${new Date().toLocaleString()}
                    
                    END OF REPORT
                `;
                
                downloadFile(report, `weekly_report_${reportDate}.txt`, 'text/plain');
                hideLoading();
                showNotification('success', 'Report Generated', 'Weekly briefing report downloaded');
            }, 1500);
        }

        function conveneRECSEC() {
            const meetingNotice = `
                URGENT: RECSEC MEETING NOTICE
                
                TO: All RECSEC Members
                FROM: Office of the Governor
                DATE: ${new Date().toLocaleDateString()}
                TIME: IMMEDIATELY
                VENUE: Governor's Conference Room, Soma
                
                AGENDA:
                1. Current security situation review
                2. Recent incidents assessment (${securityIncidents.length} incidents this period)
                3. Emergency alerts status (${emergencyAlerts.filter(a => a.status === 'Active').length} active alerts)
                4. Border security update
                5. Coordination of regional security operations
                
                REQUIRED TO ATTEND:
                - Superintendent Lamin Ceesay (Police Commander)
                - Chief Superintendent Omar Jallow (Immigration)
                - Commander Fatou N. Manneh (Drug Enforcement)
                - Chief Fire Officer Modou L. Bah (Fire & Rescue)
                - All Council Chairpersons
                - All Ministry Directors
                
                This meeting is MANDATORY and URGENT.
                
                Governor: Hon. Alhaji S. Jawara
                Regional Governor, Lower River Region
            `;
            
            downloadFile(meetingNotice, 'recsec_meeting_notice.txt', 'text/plain');
            showNotification('success', 'Meeting Convened', 'RECSEC meeting notice sent');
        }

        function openExportModal() {
            document.getElementById('exportModal').style.display = 'flex';
        }

        function closeExportModal() {
            document.getElementById('exportModal').style.display = 'none';
        }

        function openSettings() {
            showSection('settings');
            document.getElementById('userMenuDropdown').classList.remove('show');
        }

        // ==============================================
        // AUTO-REFRESH AND SESSION MANAGEMENT
        // ==============================================
        
        function startAutoRefresh() {
            // Auto-refresh metrics every 5 minutes
            setInterval(() => {
                populateMetricCards();
                updateAlertCount();
            }, 5 * 60 * 1000);
        }

        function setupEventListeners() {
            // Reset session timer on any user interaction
            document.addEventListener('click', resetSessionTimer);
            document.addEventListener('keypress', resetSessionTimer);
            document.addEventListener('scroll', resetSessionTimer);
            
            // Search functionality
            const searchInput = document.querySelector('.search-input');
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const searchTerm = this.value.toLowerCase();
                    let results = [];
                    
                    // Search in incidents
                    const incidentResults = securityIncidents.filter(incident => 
                        incident.type.toLowerCase().includes(searchTerm) ||
                        incident.district.toLowerCase().includes(searchTerm) ||
                        incident.village.toLowerCase().includes(searchTerm)
                    );
                    
                    // Search in reports
                    const reportResults = weeklyReports.filter(report => 
                        report.department.toLowerCase().includes(searchTerm) ||
                        report.report_type.toLowerCase().includes(searchTerm)
                    );
                    
                    if (incidentResults.length > 0 || reportResults.length > 0) {
                        showNotification('info', 'Search Results', `Found ${incidentResults.length} incidents and ${reportResults.length} reports`);
                        this.value = '';
                    } else {
                        showNotification('info', 'Search', 'No results found');
                    }
                }
            });
            
            // Close modals when clicking outside
            document.getElementById('exportModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeExportModal();
                }
            });
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Check for existing session
            const session = sessionStorage.getItem('governorSession');
            if (session) {
                const sessionData = JSON.parse(session);
                if (sessionData.authenticated) {
                    document.getElementById('loginContainer').style.display = 'none';
                    document.getElementById('dashboardContainer').style.display = 'block';
                    initializeDashboard();
                    resetSessionTimer();
                }
            }
        });

        // Prevent right-click and keyboard shortcuts for security
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });

        document.addEventListener('keydown', function(e) {
            // Disable F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U
            if (e.keyCode === 123 || 
                (e.ctrlKey && e.shiftKey && e.keyCode === 73) ||
                (e.ctrlKey && e.shiftKey && e.keyCode === 74) ||
                (e.ctrlKey && e.keyCode === 85)) {
                e.preventDefault();
                showNotification('error', 'Security Alert', 'Developer tools are disabled in this system');
            }
        });
    </script>
</body>
</html>
