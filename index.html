<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Governor's Dashboard - Lower River Region</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ALL ORIGINAL CSS REMAINS EXACTLY THE SAME */
        :root {
            --gold: #FFD700;
            --silver: #C0C0C0;
            --diamond: #B9F2FF;
            --dark-blue: #003366;
            --light-blue: #E6F2FF;
            --green: #006600;
            --white: #FFFFFF;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--light-blue) 0%, var(--white) 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: 40px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header Styles */
        header {
            background: linear-gradient(90deg, var(--dark-blue) 0%, #001a33 100%);
            color: var(--gold);
            padding: 25px 0;
            box-shadow: var(--shadow);
            border-bottom: 5px solid var(--gold);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23FFD700' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 2;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo i {
            font-size: 2.8rem;
            color: var(--gold);
        }
        
        .logo-text h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            letter-spacing: 1px;
        }
        
        .logo-text h2 {
            font-size: 1.2rem;
            color: var(--silver);
            font-weight: 400;
        }
        
        .governor-info {
            text-align: right;
            border-right: 3px solid var(--gold);
            padding-right: 20px;
        }
        
        .governor-info h3 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        
        .governor-info p {
            color: var(--diamond);
            font-size: 1rem;
        }
        
        /* Control Panel */
        .control-panel {
            background: var(--white);
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
            box-shadow: var(--shadow);
            border: 1px solid var(--silver);
        }
        
        .panel-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 25px;
            color: var(--dark-blue);
            border-bottom: 2px solid var(--gold);
            padding-bottom: 10px;
        }
        
        .panel-title i {
            color: var(--gold);
            font-size: 1.5rem;
        }
        
        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
        }
        
        .filter-group label {
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-blue);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .filter-group label i {
            color: var(--gold);
        }
        
        select {
            padding: 12px 15px;
            border: 2px solid var(--silver);
            border-radius: 8px;
            background-color: var(--white);
            font-size: 1rem;
            color: #333;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        select:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, var(--gold) 0%, #FFED4E 100%);
            color: var(--dark-blue);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(255, 215, 0, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(90deg, var(--silver) 0%, #E8E8E8 100%);
            color: var(--dark-blue);
        }
        
        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(192, 192, 192, 0.3);
        }
        
        .btn-diamond {
            background: linear-gradient(90deg, var(--diamond) 0%, #E6F7FF 100%);
            color: var(--dark-blue);
            border: 1px solid var(--diamond);
        }
        
        .btn-diamond:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(185, 242, 255, 0.3);
        }
        
        /* Data Display Area */
        .data-display {
            background: var(--white);
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
            box-shadow: var(--shadow);
            border: 1px solid var(--silver);
            overflow-x: auto;
        }
        
        .data-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--gold);
        }
        
        .data-header h3 {
            color: var(--dark-blue);
            font-size: 1.5rem;
        }
        
        .data-count {
            background: var(--diamond);
            color: var(--dark-blue);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        thead {
            background: linear-gradient(90deg, var(--dark-blue) 0%, #00264d 100%);
            color: var(--gold);
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--silver);
        }
        
        th {
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        tr:hover {
            background-color: rgba(255, 215, 0, 0.05);
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-active {
            background-color: var(--green);
        }
        
        .status-pending {
            background-color: #FFA500;
        }
        
        .status-inactive {
            background-color: #FF0000;
        }
        
        /* Traditional Authority Section */
        .traditional-section {
            display: none;
            background: var(--white);
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
            box-shadow: var(--shadow);
            border: 1px solid var(--silver);
        }
        
        .traditional-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--gold);
        }
        
        .districts-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }
        
        .district-card {
            border: 1px solid var(--silver);
            border-radius: 10px;
            padding: 20px;
            background: #f9f9f9;
            transition: all 0.3s ease;
        }
        
        .district-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            border-color: var(--gold);
        }
        
        .district-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--silver);
        }
        
        .district-name {
            font-size: 1.3rem;
            color: var(--dark-blue);
            font-weight: 600;
        }
        
        .village-selector {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 215, 0, 0.05);
            border-radius: 8px;
            border-left: 4px solid var(--gold);
        }
        
        /* Login Modal - ENHANCED */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background: var(--white);
            padding: 40px;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            border: 3px solid var(--gold);
            animation: slideUp 0.4s ease;
        }
        
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal-header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }
        
        .modal-header h3 {
            color: var(--dark-blue);
            font-size: 2rem;
            margin-bottom: 15px;
            border-bottom: 2px solid var(--gold);
            padding-bottom: 10px;
        }
        
        .security-warning {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid #ff0000;
            border-left: 4px solid #ff0000;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            text-align: left;
        }
        
        .security-warning h4 {
            color: #cc0000;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .security-warning ul {
            margin-left: 20px;
            margin-top: 8px;
            font-size: 0.9rem;
        }
        
        .security-warning li {
            margin-bottom: 5px;
        }
        
        .input-group {
            margin-bottom: 25px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark-blue);
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .input-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--silver);
            border-radius: 8px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
        }
        
        .modal-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }
        
        .btn-logout {
            background: linear-gradient(90deg, #990000 0%, #cc0000 100%);
            color: white;
        }
        
        .btn-logout:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(204, 0, 0, 0.3);
        }
        
        /* Footer */
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px 0;
            color: var(--dark-blue);
            border-top: 1px solid var(--silver);
            font-size: 0.9rem;
        }
        
        .admin-access {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .admin-btn {
            background: transparent;
            border: 1px solid var(--gold);
            color: var(--gold);
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .admin-btn:hover {
            background: rgba(255, 215, 0, 0.1);
        }
        
        .login-status {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(0, 102, 0, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
            color: var(--green);
            font-weight: 600;
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }
            
            .governor-info {
                text-align: center;
                border-right: none;
                padding-right: 0;
                border-bottom: 3px solid var(--gold);
                padding-bottom: 15px;
            }
            
            .filters {
                grid-template-columns: 1fr;
            }
            
            .admin-access {
                flex-direction: column;
                gap: 10px;
            }
        }
        
        @media (max-width: 768px) {
            .districts-container {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .modal-content {
                padding: 25px;
            }
        }
        
        /* Session Timeout Warning */
        .timeout-warning {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #ff9900;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 9999;
            display: none;
            align-items: center;
            gap: 10px;
            animation: slideInRight 0.3s ease;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        .shake {
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
    </style>
</head>
<body>
    <!-- Enhanced Login Modal -->
    <div id="loginModal" class="modal" style="display: flex;">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-shield-alt" style="font-size: 3.5rem; color: var(--gold); margin-bottom: 20px;"></i>
                <h3>GOVERNMENT SECURE ACCESS PORTAL</h3>
                <p>Lower River Region - Governor's Dashboard</p>
                
                <div class="security-warning">
                    <h4><i class="fas fa-exclamation-triangle"></i> SECURITY NOTICE - CLASSIFIED INFORMATION</h4>
                    <p>This system contains <strong>CLASSIFIED GOVERNMENT DATA</strong> protected under The Gambia Official Secrets Act. Unauthorized access, disclosure, or dissemination is strictly prohibited and punishable by law with penalties including:</p>
                    <ul>
                        <li>Imprisonment up to 25 years</li>
                        <li>Substantial financial penalties</li>
                        <li>Permanent security clearance revocation</li>
                        <li>Criminal prosecution under national security laws</li>
                    </ul>
                    <p><strong>By proceeding, you confirm you are an authorized government official with proper security clearance.</strong></p>
                </div>
            </div>
            
            <div class="input-group">
                <label for="password"><i class="fas fa-key"></i> ENTER SECURITY PASSWORD</label>
                <input type="password" id="password" placeholder="Enter authorized access password" autocomplete="off">
                <div id="passwordError" style="color: #FF0000; margin-top: 10px; display: none; font-weight: bold;">
                    <i class="fas fa-times-circle"></i> ACCESS DENIED: Incorrect password. Unauthorized attempts are logged.
                </div>
                <div id="attemptsWarning" style="color: #FF9900; margin-top: 10px; display: none;">
                    <i class="fas fa-exclamation-circle"></i> Warning: Multiple failed attempts may trigger security protocols.
                </div>
            </div>
            
            <div class="modal-actions">
                <button id="loginBtn" class="btn btn-primary">
                    <i class="fas fa-unlock-alt"></i> ACCESS SECURE DASHBOARD
                </button>
            </div>
            
            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--silver); text-align: center;">
                <p style="color: #666; font-size: 0.9rem;">
                    <i class="fas fa-info-circle"></i> For authorized personnel only. Password: <strong>governorlrr@2025</strong>
                </p>
            </div>
        </div>
    </div>

    <!-- Session Timeout Warning -->
    <div id="timeoutWarning" class="timeout-warning">
        <i class="fas fa-clock"></i>
        <div>
            <strong>Session Expiring</strong>
            <div>Your secure session will expire in <span id="timeoutCountdown">60</span> seconds</div>
        </div>
        <button id="extendSessionBtn" class="btn" style="padding: 5px 10px; font-size: 0.8rem; background: white; color: #333;">
            Extend
        </button>
    </div>

    <!-- Main Dashboard Content -->
    <div id="dashboardContent" style="display: none;">
        <!-- Header -->
        <header>
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <i class="fas fa-landmark"></i>
                        <div class="logo-text">
                            <h1>Governor's Regional Management Dashboard</h1>
                            <h2>Lower River Region, The Gambia</h2>
                        </div>
                    </div>
                    <div class="governor-info">
                        <h3>HON. SEEDY LAMIN BAH</h3>
                        <p>Governor, Lower River Region</p>
                    </div>
                    <div class="admin-access">
                        <div id="loginStatus" class="login-status">
                            <i class="fas fa-user-shield"></i>
                            <span>SECURE ACCESS ACTIVE</span>
                            <div style="margin-left: 10px; font-size: 0.8rem; color: #666;">
                                | Session: <span id="sessionTimer">30:00</span>
                            </div>
                        </div>
                        <button id="adminBtn" class="admin-btn">
                            <i class="fas fa-user-cog"></i> Admin Edit
                        </button>
                        <button id="logoutBtn" class="btn btn-logout">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <div class="container">
            <!-- Security Banner -->
            <div style="background: linear-gradient(90deg, #003366 0%, #001a33 100%); color: white; padding: 15px; border-radius: 8px; margin: 20px 0; border-left: 5px solid var(--gold);">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <i class="fas fa-shield-alt" style="font-size: 1.5rem; color: var(--gold);"></i>
                    <div style="flex-grow: 1;">
                        <strong><i class="fas fa-exclamation-triangle"></i> CLASSIFIED GOVERNMENT INFORMATION</strong>
                        <p style="margin-top: 5px; font-size: 0.9rem; opacity: 0.9;">
                            This dashboard contains sensitive government data protected under The Gambia Official Secrets Act. 
                            Unauthorized access, copying, or dissemination is a criminal offense punishable by law.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Control Panel -->
            <section class="control-panel">
                <div class="panel-title">
                    <i class="fas fa-filter"></i>
                    <h2>Data Filtering & Analysis Panel</h2>
                </div>
                
                <div class="filters">
                    <div class="filter-group">
                        <label for="stakeholderFilter"><i class="fas fa-users"></i> Key Stakeholders</label>
                        <select id="stakeholderFilter">
                            <option value="all">All Stakeholders</option>
                            <option value="1">1. Regional Council & Local Government</option>
                            <option value="2">2. Regional Security Committee (RECSEC)</option>
                            <option value="3">3. Central Government Ministry Heads</option>
                            <option value="4">4. Traditional Authority Structure</option>
                            <option value="5">5. Elected National Representatives</option>
                            <option value="6">6. Alikalos & Grassroots Structures</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="subDeptFilter"><i class="fas fa-sitemap"></i> Sub-Department</label>
                        <select id="subDeptFilter">
                            <option value="all">All Sub-Departments</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="workCategoryFilter"><i class="fas fa-tasks"></i> Work Categories</label>
                        <select id="workCategoryFilter">
                            <option value="all">All Work Categories</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="actionFilter"><i class="fas fa-chart-line"></i> Action</label>
                        <select id="actionFilter">
                            <option value="view">View Regional Statistics</option>
                            <option value="download">Download CSV</option>
                        </select>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button id="applyFiltersBtn" class="btn btn-primary">
                        <i class="fas fa-search"></i> Apply Filters
                    </button>
                    <button id="resetFiltersBtn" class="btn btn-secondary">
                        <i class="fas fa-redo"></i> Reset Filters
                    </button>
                    <button id="downloadAllBtn" class="btn btn-diamond">
                        <i class="fas fa-download"></i> Download All Data (CSV)
                    </button>
                    <button id="viewStatsBtn" class="btn btn-diamond">
                        <i class="fas fa-chart-bar"></i> View Regional Statistics
                    </button>
                </div>
            </section>

            <!-- Main Data Display -->
            <section class="data-display" id="mainDataDisplay">
                <div class="data-header">
                    <h3>Regional Data Overview</h3>
                    <div class="data-count">
                        <span id="dataCount">0</span> Records Found
                    </div>
                </div>
                <div id="tableContainer">
                    <!-- Table will be generated by JavaScript -->
                </div>
            </section>

            <!-- Traditional Authority Display -->
            <section class="traditional-section" id="traditionalSection">
                <div class="traditional-header">
                    <h3>Traditional Authority Structure - Districts & Villages</h3>
                    <button id="downloadTraditionalBtn" class="btn btn-primary">
                        <i class="fas fa-download"></i> Download All Traditional Data
                    </button>
                </div>
                <div id="districtsContainer" class="districts-container">
                    <!-- District cards will be generated by JavaScript -->
                </div>
            </section>

            <!-- Footer -->
            <footer>
                <p>Governor's Dashboard &copy; 2025 - Lower River Region, The Gambia</p>
                <p>Data last updated: <span id="lastUpdated">June 15, 2025</span></p>
                <p style="margin-top: 10px; font-size: 0.8rem; color: #666;">
                    <i class="fas fa-shield-alt"></i> Classified Government Information - Protected under The Gambia Official Secrets Act
                </p>
            </footer>
        </div>
    </div>

    <script>
        // PASSWORD SETTINGS
        const SECURITY_PASSWORD = "governorlrr@2025";
        const SESSION_TIMEOUT_MINUTES = 30;
        const SESSION_WARNING_MINUTES = 5;

        // Application State
        let isLoggedIn = false;
        let isAdminMode = false;
        let sessionTimer;
        let sessionSecondsRemaining = SESSION_TIMEOUT_MINUTES * 60;
        let failedAttempts = 0;
        const MAX_ATTEMPTS = 5;

        // Data Structure (EXACTLY AS BEFORE - unchanged)
        const regionData = {
            stakeholders: [
                // ... ALL YOUR EXISTING DATA HERE (unchanged)
                // Since the data is extremely long, I'm keeping the structure reference only
                // Your complete data from the original file remains exactly the same
            ],
            traditionalData: {
                // ... ALL YOUR EXISTING TRADITIONAL DATA HERE (unchanged)
            }
        };

        // DOM Elements
        const loginModal = document.getElementById('loginModal');
        const dashboardContent = document.getElementById('dashboardContent');
        const passwordInput = document.getElementById('password');
        const loginBtn = document.getElementById('loginBtn');
        const passwordError = document.getElementById('passwordError');
        const attemptsWarning = document.getElementById('attemptsWarning');
        const logoutBtn = document.getElementById('logoutBtn');
        const adminBtn = document.getElementById('adminBtn');
        const loginStatus = document.getElementById('loginStatus');
        const sessionTimerDisplay = document.getElementById('sessionTimer');
        const timeoutWarning = document.getElementById('timeoutWarning');
        const timeoutCountdown = document.getElementById('timeoutCountdown');
        const extendSessionBtn = document.getElementById('extendSessionBtn');

        // Dashboard DOM elements (from original code)
        const stakeholderFilter = document.getElementById('stakeholderFilter');
        const subDeptFilter = document.getElementById('subDeptFilter');
        const workCategoryFilter = document.getElementById('workCategoryFilter');
        const actionFilter = document.getElementById('actionFilter');
        const applyFiltersBtn = document.getElementById('applyFiltersBtn');
        const resetFiltersBtn = document.getElementById('resetFiltersBtn');
        const downloadAllBtn = document.getElementById('downloadAllBtn');
        const viewStatsBtn = document.getElementById('viewStatsBtn');
        const mainDataDisplay = document.getElementById('mainDataDisplay');
        const traditionalSection = document.getElementById('traditionalSection');
        const tableContainer = document.getElementById('tableContainer');
        const districtsContainer = document.getElementById('districtsContainer');
        const dataCount = document.getElementById('dataCount');
        const downloadTraditionalBtn = document.getElementById('downloadTraditionalBtn');
        const lastUpdated = document.getElementById('lastUpdated');

        // Current filter state (from original code)
        let currentFilters = {
            stakeholder: 'all',
            subDepartment: 'all',
            workCategory: 'all'
        };

        // Initialize the application
        function init() {
            // Check for existing session
            const savedSession = sessionStorage.getItem('govDashboardSession');
            if (savedSession) {
                const sessionData = JSON.parse(savedSession);
                if (sessionData.expires > Date.now()) {
                    // Valid session exists
                    isLoggedIn = true;
                    showDashboard();
                    startSessionTimer();
                    return;
                } else {
                    // Session expired
                    sessionStorage.removeItem('govDashboardSession');
                }
            }
            
            // Show login modal
            showLoginModal();
            
            // Set last updated date
            lastUpdated.textContent = new Date().toLocaleDateString('en-GB', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
        }

        // Show login modal
        function showLoginModal() {
            loginModal.style.display = 'flex';
            dashboardContent.style.display = 'none';
            passwordInput.focus();
        }

        // Handle login
        loginBtn.addEventListener('click', handleLogin);
        passwordInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                handleLogin();
            }
        });

        function handleLogin() {
            const password = passwordInput.value.trim();
            
            if (password === SECURITY_PASSWORD) {
                // Successful login
                isLoggedIn = true;
                failedAttempts = 0;
                passwordError.style.display = 'none';
                attemptsWarning.style.display = 'none';
                
                // Create session
                const sessionData = {
                    loggedIn: true,
                    expires: Date.now() + (SESSION_TIMEOUT_MINUTES * 60 * 1000)
                };
                sessionStorage.setItem('govDashboardSession', JSON.stringify(sessionData));
                
                // Show dashboard
                showDashboard();
                startSessionTimer();
                
                // Log successful access
                console.log(`Secure access granted: ${new Date().toISOString()}`);
            } else {
                // Failed login
                failedAttempts++;
                passwordError.style.display = 'block';
                passwordInput.classList.add('shake');
                
                // Show attempts warning after 2 failed attempts
                if (failedAttempts >= 2) {
                    attemptsWarning.style.display = 'block';
                    attemptsWarning.innerHTML = `
                        <i class="fas fa-exclamation-circle"></i> 
                        Warning: ${failedAttempts} failed attempts. After ${MAX_ATTEMPTS} attempts, access will be temporarily blocked.
                    `;
                }
                
                // Clear shake animation
                setTimeout(() => {
                    passwordInput.classList.remove('shake');
                }, 500);
                
                // Clear password field
                passwordInput.value = '';
                passwordInput.focus();
                
                // Log failed attempt
                console.warn(`Failed access attempt (${failedAttempts}): ${new Date().toISOString()}`);
                
                // Block after maximum attempts
                if (failedAttempts >= MAX_ATTEMPTS) {
                    loginBtn.disabled = true;
                    passwordInput.disabled = true;
                    passwordError.innerHTML = `
                        <i class="fas fa-ban"></i> 
                        ACCESS TEMPORARILY BLOCKED: Too many failed attempts. Please try again later.
                    `;
                    
                    // Auto-enable after 5 minutes
                    setTimeout(() => {
                        loginBtn.disabled = false;
                        passwordInput.disabled = false;
                        failedAttempts = 0;
                        passwordError.style.display = 'none';
                        attemptsWarning.style.display = 'none';
                    }, 300000); // 5 minutes
                }
            }
        }

        // Show dashboard
        function showDashboard() {
            loginModal.style.display = 'none';
            dashboardContent.style.display = 'block';
            
            // Initialize dashboard components
            initializeDashboard();
            
            // Apply initial filters
            applyFilters();
            
            // Generate traditional display
            generateTraditionalDisplay();
        }

        // Initialize dashboard components (original functionality)
        function initializeDashboard() {
            // Populate stakeholder filter
            populateStakeholderFilter();
            
            // Set up event listeners
            setupDashboardEventListeners();
        }

        // Start session timer
        function startSessionTimer() {
            sessionSecondsRemaining = SESSION_TIMEOUT_MINUTES * 60;
            updateSessionTimerDisplay();
            
            // Clear existing timer
            if (sessionTimer) {
                clearInterval(sessionTimer);
            }
            
            // Start new timer
            sessionTimer = setInterval(() => {
                sessionSecondsRemaining--;
                updateSessionTimerDisplay();
                
                // Show warning 5 minutes before timeout
                if (sessionSecondsRemaining === SESSION_WARNING_MINUTES * 60) {
                    showTimeoutWarning();
                }
                
                // Logout on timeout
                if (sessionSecondsRemaining <= 0) {
                    logout();
                }
            }, 1000);
        }

        // Update session timer display
        function updateSessionTimerDisplay() {
            const minutes = Math.floor(sessionSecondsRemaining / 60);
            const seconds = sessionSecondsRemaining % 60;
            sessionTimerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Show timeout warning
        function showTimeoutWarning() {
            timeoutWarning.style.display = 'flex';
            let countdown = 60;
            timeoutCountdown.textContent = countdown;
            
            const countdownInterval = setInterval(() => {
                countdown--;
                timeoutCountdown.textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                }
            }, 1000);
        }

        // Extend session
        extendSessionBtn.addEventListener('click', function() {
            sessionSecondsRemaining = SESSION_TIMEOUT_MINUTES * 60;
            updateSessionTimerDisplay();
            timeoutWarning.style.display = 'none';
            
            // Update session storage
            const sessionData = {
                loggedIn: true,
                expires: Date.now() + (SESSION_TIMEOUT_MINUTES * 60 * 1000)
            };
            sessionStorage.setItem('govDashboardSession', JSON.stringify(sessionData));
        });

        // Logout function
        logoutBtn.addEventListener('click', logout);

        function logout() {
            // Clear session
            sessionStorage.removeItem('govDashboardSession');
            
            // Reset state
            isLoggedIn = false;
            isAdminMode = false;
            
            // Clear timers
            if (sessionTimer) {
                clearInterval(sessionTimer);
            }
            
            // Reset UI
            showLoginModal();
            passwordInput.value = '';
            passwordError.style.display = 'none';
            attemptsWarning.style.display = 'none';
            timeoutWarning.style.display = 'none';
            
            // Reset failed attempts
            failedAttempts = 0;
            
            // Log logout
            console.log(`User logged out: ${new Date().toISOString()}`);
        }

        // ============ ORIGINAL DASHBOARD FUNCTIONALITY ============
        // ALL ORIGINAL FUNCTIONS REMAIN EXACTLY THE SAME
        // Only integrated with the new security system

        function populateStakeholderFilter() {
            stakeholderFilter.addEventListener('change', function() {
                currentFilters.stakeholder = this.value;
                populateSubDepartmentFilter();
                
                if (this.value === '4' || this.value === '6') {
                    mainDataDisplay.style.display = 'none';
                    traditionalSection.style.display = 'block';
                } else {
                    mainDataDisplay.style.display = 'block';
                    traditionalSection.style.display = 'none';
                }
            });
        }

        function populateSubDepartmentFilter() {
            subDeptFilter.innerHTML = '<option value="all">All Sub-Departments</option>';
            
            if (currentFilters.stakeholder === 'all') {
                const allSubDepts = [];
                regionData.stakeholders.forEach(stakeholder => {
                    stakeholder.subDepartments.forEach(subDept => {
                        allSubDepts.push({
                            id: subDept.id,
                            name: subDept.name,
                            stakeholderId: stakeholder.id
                        });
                    });
                });
                
                allSubDepts.sort((a, b) => a.name.localeCompare(b.name));
                allSubDepts.forEach(subDept => {
                    const option = document.createElement('option');
                    option.value = subDept.id;
                    option.textContent = `${subDept.name} (Stakeholder ${subDept.stakeholderId})`;
                    subDeptFilter.appendChild(option);
                });
            } else {
                const stakeholder = regionData.stakeholders.find(s => s.id == currentFilters.stakeholder);
                if (stakeholder && stakeholder.subDepartments) {
                    stakeholder.subDepartments.forEach(subDept => {
                        const option = document.createElement('option');
                        option.value = subDept.id;
                        option.textContent = subDept.name;
                        subDeptFilter.appendChild(option);
                    });
                }
            }
            
            workCategoryFilter.innerHTML = '<option value="all">All Work Categories</option>';
            currentFilters.subDepartment = 'all';
            currentFilters.workCategory = 'all';
            
            subDeptFilter.addEventListener('change', function() {
                currentFilters.subDepartment = this.value;
                populateWorkCategoryFilter();
            });
        }

        function populateWorkCategoryFilter() {
            workCategoryFilter.innerHTML = '<option value="all">All Work Categories</option>';
            
            if (currentFilters.subDepartment === 'all') {
                const allWorkCategories = new Set();
                
                if (currentFilters.stakeholder === 'all') {
                    regionData.stakeholders.forEach(stakeholder => {
                        stakeholder.subDepartments.forEach(subDept => {
                            subDept.workCategories.forEach(category => {
                                allWorkCategories.add(category);
                            });
                        });
                    });
                } else {
                    const stakeholder = regionData.stakeholders.find(s => s.id == currentFilters.stakeholder);
                    if (stakeholder && stakeholder.subDepartments) {
                        stakeholder.subDepartments.forEach(subDept => {
                            subDept.workCategories.forEach(category => {
                                allWorkCategories.add(category);
                            });
                        });
                    }
                }
                
                Array.from(allWorkCategories).sort().forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    workCategoryFilter.appendChild(option);
                });
            } else {
                let workCategories = [];
                
                for (const stakeholder of regionData.stakeholders) {
                    if (stakeholder.subDepartments) {
                        const subDept = stakeholder.subDepartments.find(sd => sd.id === currentFilters.subDepartment);
                        if (subDept) {
                            workCategories = subDept.workCategories;
                            break;
                        }
                    }
                }
                
                workCategories.sort().forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    workCategoryFilter.appendChild(option);
                });
            }
            
            currentFilters.workCategory = 'all';
        }

        function setupDashboardEventListeners() {
            applyFiltersBtn.addEventListener('click', applyFilters);
            resetFiltersBtn.addEventListener('click', resetFilters);
            downloadAllBtn.addEventListener('click', downloadAllData);
            viewStatsBtn.addEventListener('click', viewStatistics);
            
            workCategoryFilter.addEventListener('change', function() {
                currentFilters.workCategory = this.value;
            });
            
            actionFilter.addEventListener('change', function() {
                if (this.value === 'download') {
                    downloadFilteredData();
                    setTimeout(() => {
                        actionFilter.value = 'view';
                    }, 100);
                }
            });
            
            adminBtn.addEventListener('click', () => {
                const adminPassword = prompt("Enter administrative password to enable edit mode:");
                if (adminPassword === SECURITY_PASSWORD) {
                    isAdminMode = true;
                    enableEditing();
                    alert('Administrative edit mode enabled.');
                } else {
                    alert('Incorrect password. Edit mode not enabled.');
                }
            });
            
            downloadTraditionalBtn.addEventListener('click', downloadTraditionalData);
        }

        function applyFilters() {
            const filteredData = getFilteredData();
            updateTableDisplay(filteredData);
            dataCount.textContent = filteredData.length;
        }

        function getFilteredData() {
            let filteredData = [];
            
            let stakeholdersToInclude = [];
            if (currentFilters.stakeholder === 'all') {
                stakeholdersToInclude = regionData.stakeholders.filter(s => !s.isTraditional);
            } else {
                const stakeholder = regionData.stakeholders.find(s => s.id == currentFilters.stakeholder);
                if (stakeholder && !stakeholder.isTraditional) {
                    stakeholdersToInclude = [stakeholder];
                }
            }
            
            stakeholdersToInclude.forEach(stakeholder => {
                stakeholder.subDepartments.forEach(subDept => {
                    if (currentFilters.subDepartment === 'all' || subDept.id === currentFilters.subDepartment) {
                        subDept.data.forEach(item => {
                            if (currentFilters.workCategory === 'all' || 
                                item.workCategory === currentFilters.workCategory) {
                                filteredData.push({
                                    ...item,
                                    stakeholder: stakeholder.name,
                                    subDepartment: subDept.name
                                });
                            }
                        });
                    }
                });
            });
            
            return filteredData;
        }

        function updateTableDisplay(data) {
            if (data.length === 0) {
                tableContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-database" style="font-size: 3rem; margin-bottom: 20px; color: var(--silver);"></i>
                        <h3>No Data Found</h3>
                        <p>Try adjusting your filters to see more results.</p>
                    </div>
                `;
                return;
            }
            
            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Activity Name</th>
                            <th>Status</th>
                            <th>Target</th>
                            <th>Achievement</th>
                            <th>Responsible Officer</th>
                            <th>Contact</th>
                            <th>Stakeholder</th>
                            <th>Sub-Department</th>
                            <th>Work Category</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            data.forEach(item => {
                let statusIndicator = '';
                if (item.status === 'Active') {
                    statusIndicator = '<span class="status-indicator status-active"></span>';
                } else if (item.status === 'Pending') {
                    statusIndicator = '<span class="status-indicator status-pending"></span>';
                } else {
                    statusIndicator = '<span class="status-indicator status-inactive"></span>';
                }
                
                tableHTML += `
                    <tr>
                        <td>${item.id}</td>
                        <td><strong>${item.name}</strong></td>
                        <td>${statusIndicator} ${item.status}</td>
                        <td>${item.target}</td>
                        <td>${item.achievement}</td>
                        <td>${item.officer}</td>
                        <td>${item.contact}</td>
                        <td>${item.stakeholder}</td>
                        <td>${item.subDepartment}</td>
                        <td>${item.workCategory}</td>
                        <td>${item.notes}</td>
                    </tr>
                `;
            });
            
            tableHTML += `
                    </tbody>
                </table>
            `;
            
            tableContainer.innerHTML = tableHTML;
            
            if (isAdminMode) {
                enableEditing();
            }
        }

        function generateTraditionalDisplay() {
            let districtsHTML = '';
            
            regionData.traditionalData.districts.forEach(district => {
                let villageOptions = '';
                district.villages.forEach(village => {
                    villageOptions += `<option value="${village.id}">${village.name} - ${village.head}</option>`;
                });
                
                districtsHTML += `
                    <div class="district-card">
                        <div class="district-header">
                            <div class="district-name">${district.name} District</div>
                            <button class="btn btn-primary download-chief-btn" data-district-id="${district.id}">
                                <i class="fas fa-download"></i> Download Chief Data
                            </button>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <h4 style="color: var(--dark-blue); margin-bottom: 5px;">District Chief Details</h4>
                            <p><strong>Name:</strong> ${district.chief.name}</p>
                            <p><strong>Title:</strong> ${district.chief.title}</p>
                            <p><strong>Contact:</strong> ${district.chief.contact}</p>
                            <p><strong>Tenure:</strong> ${district.chief.tenure}</p>
                            <p><strong>Status:</strong> <span class="status-indicator status-active"></span> ${district.chief.status}</p>
                            <p><strong>Notes:</strong> ${district.chief.notes}</p>
                        </div>
                        
                        <div class="village-selector">
                            <h4 style="color: var(--dark-blue); margin-bottom: 10px;">Village Heads in ${district.name}</h4>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <select class="village-select" data-district-id="${district.id}" style="flex-grow: 1; padding: 10px;">
                                    <option value="">Select a village</option>
                                    ${villageOptions}
                                </select>
                                <button class="btn btn-secondary download-village-btn" data-district-id="${district.id}" disabled>
                                    <i class="fas fa-download"></i> Download Village Data
                                </button>
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px;">
                            <h4 style="color: var(--dark-blue); margin-bottom: 5px;">Village Summary</h4>
                            <p><strong>Number of Villages:</strong> ${district.villages.length}</p>
                            <p><strong>Total Population (approx):</strong> ${district.villages.reduce((sum, village) => sum + parseInt(village.population.replace(',', '')), 0).toLocaleString()}</p>
                        </div>
                    </div>
                `;
            });
            
            districtsContainer.innerHTML = districtsHTML;
            
            document.querySelectorAll('.download-chief-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const districtId = this.getAttribute('data-district-id');
                    downloadDistrictChiefData(districtId);
                });
            });
            
            document.querySelectorAll('.village-select').forEach(select => {
                select.addEventListener('change', function() {
                    const districtId = this.getAttribute('data-district-id');
                    const downloadBtn = document.querySelector(`.download-village-btn[data-district-id="${districtId}"]`);
                    downloadBtn.disabled = !this.value;
                });
            });
            
            document.querySelectorAll('.download-village-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const districtId = this.getAttribute('data-district-id');
                    const villageSelect = document.querySelector(`.village-select[data-district-id="${districtId}"]`);
                    const villageId = villageSelect.value;
                    
                    if (villageId) {
                        downloadVillageData(villageId);
                    }
                });
            });
        }

        function resetFilters() {
            stakeholderFilter.value = 'all';
            subDeptFilter.innerHTML = '<option value="all">All Sub-Departments</option>';
            workCategoryFilter.innerHTML = '<option value="all">All Work Categories</option>';
            actionFilter.value = 'view';
            
            currentFilters = {
                stakeholder: 'all',
                subDepartment: 'all',
                workCategory: 'all'
            };
            
            mainDataDisplay.style.display = 'block';
            traditionalSection.style.display = 'none';
            
            applyFilters();
        }

        function downloadAllData() {
            let allData = [];
            
            regionData.stakeholders.forEach(stakeholder => {
                if (!stakeholder.isTraditional) {
                    stakeholder.subDepartments.forEach(subDept => {
                        subDept.data.forEach(item => {
                            allData.push({
                                ID: item.id,
                                Activity: item.name,
                                Status: item.status,
                                Target: item.target,
                                Achievement: item.achievement,
                                Officer: item.officer,
                                Contact: item.contact,
                                Stakeholder: stakeholder.name,
                                SubDepartment: subDept.name,
                                WorkCategory: item.workCategory,
                                Notes: item.notes
                            });
                        });
                    });
                }
            });
            
            const csv = convertToCSV(allData);
            downloadCSV(csv, 'Lower_River_Region_All_Data.csv');
        }

        function downloadFilteredData() {
            const filteredData = getFilteredData();
            
            if (filteredData.length === 0) {
                alert('No data to download with current filters.');
                return;
            }
            
            const csvData = filteredData.map(item => ({
                ID: item.id,
                Activity: item.name,
                Status: item.status,
                Target: item.target,
                Achievement: item.achievement,
                Officer: item.officer,
                Contact: item.contact,
                Stakeholder: item.stakeholder,
                SubDepartment: item.subDepartment,
                WorkCategory: item.workCategory,
                Notes: item.notes
            }));
            
            const csv = convertToCSV(csvData);
            
            let filename = 'Lower_River_Region_';
            if (currentFilters.stakeholder !== 'all') {
                const stakeholder = regionData.stakeholders.find(s => s.id == currentFilters.stakeholder);
                filename += stakeholder.name.replace(/[^a-zA-Z0-9]/g, '_') + '_';
            }
            if (currentFilters.subDepartment !== 'all') {
                filename += 'Filtered_';
            }
            filename += 'Data.csv';
            
            downloadCSV(csv, filename);
        }

        function viewStatistics() {
            const filteredData = getFilteredData();
            
            if (filteredData.length === 0) {
                alert('No data to display statistics for with current filters.');
                return;
            }
            
            const totalItems = filteredData.length;
            const activeItems = filteredData.filter(item => item.status === 'Active').length;
            const pendingItems = filteredData.filter(item => item.status === 'Pending').length;
            const inactiveItems = filteredData.filter(item => item.status === 'Inactive').length;
            
            let totalAchievement = 0;
            let itemsWithAchievement = 0;
            
            filteredData.forEach(item => {
                const match = item.achievement.match(/(\d+)%/);
                if (match) {
                    totalAchievement += parseInt(match[1]);
                    itemsWithAchievement++;
                }
            });
            
            const avgAchievement = itemsWithAchievement > 0 ? (totalAchievement / itemsWithAchievement).toFixed(1) : 'N/A';
            
            const statsHTML = `
                <div style="background: linear-gradient(135deg, var(--diamond) 0%, var(--light-blue) 100%); padding: 25px; border-radius: 10px; margin-top: 20px;">
                    <h3 style="color: var(--dark-blue); margin-bottom: 20px; border-bottom: 2px solid var(--gold); padding-bottom: 10px;">Regional Statistics Summary</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div style="text-align: center; padding: 15px; background: white; border-radius: 8px; box-shadow: var(--shadow);">
                            <div style="font-size: 2.5rem; color: var(--dark-blue); font-weight: bold;">${totalItems}</div>
                            <div style="color: #666;">Total Activities</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: white; border-radius: 8px; box-shadow: var(--shadow);">
                            <div style="font-size: 2.5rem; color: var(--green); font-weight: bold;">${activeItems}</div>
                            <div style="color: #666;">Active Activities</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: white; border-radius: 8px; box-shadow: var(--shadow);">
                            <div style="font-size: 2.5rem; color: #FFA500; font-weight: bold;">${pendingItems}</div>
                            <div style="color: #666;">Pending Activities</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: white; border-radius: 8px; box-shadow: var(--shadow);">
                            <div style="font-size: 2.5rem; color: ${avgAchievement === 'N/A' ? '#666' : avgAchievement >= 80 ? 'var(--green)' : avgAchievement >= 60 ? '#FFA500' : '#FF0000'}; font-weight: bold;">${avgAchievement}${avgAchievement !== 'N/A' ? '%' : ''}</div>
                            <div style="color: #666;">Average Achievement</div>
                        </div>
                    </div>
                    <div style="margin-top: 20px; padding: 15px; background: rgba(255, 215, 0, 0.1); border-radius: 8px; border-left: 4px solid var(--gold);">
                        <h4 style="color: var(--dark-blue); margin-bottom: 10px;">Filter Summary</h4>
                        <p><strong>Stakeholder:</strong> ${currentFilters.stakeholder === 'all' ? 'All' : regionData.stakeholders.find(s => s.id == currentFilters.stakeholder).name}</p>
                        <p><strong>Sub-Department:</strong> ${currentFilters.subDepartment === 'all' ? 'All' : 'Selected'}</p>
                        <p><strong>Work Category:</strong> ${currentFilters.workCategory === 'all' ? 'All' : currentFilters.workCategory}</p>
                    </div>
                </div>
            `;
            
            const existingStats = document.getElementById('statsDisplay');
            if (existingStats) {
                existingStats.innerHTML = statsHTML;
            } else {
                const statsDiv = document.createElement('div');
                statsDiv.id = 'statsDisplay';
                statsDiv.innerHTML = statsHTML;
                tableContainer.appendChild(statsDiv);
            }
        }

        function downloadTraditionalData() {
            let traditionalCSVData = [];
            
            regionData.traditionalData.districts.forEach(district => {
                traditionalCSVData.push({
                    Type: 'District Chief',
                    District: district.name,
                    Name: district.chief.name,
                    Title: district.chief.title,
                    Contact: district.chief.contact,
                    Tenure: district.chief.tenure,
                    Status: district.chief.status,
                    Notes: district.chief.notes
                });
                
                district.villages.forEach(village => {
                    traditionalCSVData.push({
                        Type: 'Village Head',
                        District: district.name,
                        Village: village.name,
                        Name: village.head,
                        Contact: village.contact,
                        Population: village.population,
                        Status: village.status,
                        Issues: village.issues
                    });
                });
            });
            
            const csv = convertToCSV(traditionalCSVData);
            downloadCSV(csv, 'Lower_River_Region_Traditional_Authority_Data.csv');
        }

        function downloadDistrictChiefData(districtId) {
            const district = regionData.traditionalData.districts.find(d => d.id === districtId);
            
            if (!district) return;
            
            const csvData = [{
                Type: 'District Chief',
                District: district.name,
                Name: district.chief.name,
                Title: district.chief.title,
                Contact: district.chief.contact,
                Tenure: district.chief.tenure,
                Status: district.chief.status,
                Notes: district.chief.notes
            }];
            
            const csv = convertToCSV(csvData);
            downloadCSV(csv, `${district.name.replace(/ /g, '_')}_Chief_Data.csv`);
        }

        function downloadVillageData(villageId) {
            let targetVillage = null;
            let districtName = '';
            
            for (const district of regionData.traditionalData.districts) {
                const village = district.villages.find(v => v.id === villageId);
                if (village) {
                    targetVillage = village;
                    districtName = district.name;
                    break;
                }
            }
            
            if (!targetVillage) return;
            
            const csvData = [{
                Type: 'Village Head',
                District: districtName,
                Village: targetVillage.name,
                Name: targetVillage.head,
                Contact: targetVillage.contact,
                Population: targetVillage.population,
                Status: targetVillage.status,
                Issues: targetVillage.issues
            }];
            
            const csv = convertToCSV(csvData);
            downloadCSV(csv, `${districtName.replace(/ /g, '_')}_${targetVillage.name.replace(/ /g, '_')}_Data.csv`);
        }

        function convertToCSV(data) {
            if (data.length === 0) return '';
            
            const headers = Object.keys(data[0]);
            const csvRows = [];
            
            csvRows.push(headers.join(','));
            
            for (const row of data) {
                const values = headers.map(header => {
                    const value = row[header];
                    const escaped = String(value).replace(/"/g, '""');
                    return escaped.includes(',') || escaped.includes('"') ? `"${escaped}"` : escaped;
                });
                csvRows.push(values.join(','));
            }
            
            return csvRows.join('\n');
        }

        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function enableEditing() {
            const tableRows = document.querySelectorAll('#tableContainer tbody tr');
            tableRows.forEach(row => {
                const editCell = document.createElement('td');
                editCell.innerHTML = '<button class="btn" style="padding: 5px 10px; font-size: 0.8rem;"><i class="fas fa-edit"></i> Edit</button>';
                row.appendChild(editCell);
                
                const editBtn = editCell.querySelector('button');
                editBtn.addEventListener('click', function() {
                    enableRowEditing(row);
                });
            });
            
            document.querySelectorAll('.district-card').forEach(card => {
                const editBtn = document.createElement('button');
                editBtn.className = 'btn btn-secondary';
                editBtn.style.marginTop = '10px';
                editBtn.innerHTML = '<i class="fas fa-edit"></i> Edit District Data';
                editBtn.addEventListener('click', function() {
                    alert('District editing functionality would be implemented here.');
                });
                
                card.appendChild(editBtn);
            });
            
            adminBtn.innerHTML = '<i class="fas fa-user-edit"></i> Edit Mode';
            adminBtn.style.background = 'var(--gold)';
            adminBtn.style.color = 'var(--dark-blue)';
        }

        function enableRowEditing(row) {
            const cells = row.querySelectorAll('td');
            
            for (let i = 0; i < cells.length - 1; i++) {
                const cell = cells[i];
                const originalContent = cell.textContent;
                
                const input = document.createElement('input');
                input.type = 'text';
                input.value = originalContent.trim();
                input.style.width = '100%';
                input.style.padding = '5px';
                input.style.border = '1px solid var(--gold)';
                
                cell.innerHTML = '';
                cell.appendChild(input);
            }
            
            const actionCell = cells[cells.length - 1];
            const button = actionCell.querySelector('button');
            button.innerHTML = '<i class="fas fa-save"></i> Save';
            button.style.background = 'var(--green)';
            button.style.color = 'white';
            
            button.onclick = function() {
                saveRowEdits(row);
            };
        }

        function saveRowEdits(row) {
            const cells = row.querySelectorAll('td');
            const updatedData = [];
            
            for (let i = 0; i < cells.length - 1; i++) {
                const cell = cells[i];
                const input = cell.querySelector('input');
                updatedData.push(input.value);
                
                cell.textContent = input.value;
            }
            
            const actionCell = cells[cells.length - 1];
            const button = actionCell.querySelector('button');
            button.innerHTML = '<i class="fas fa-edit"></i> Edit';
            button.style.background = '';
            button.style.color = '';
            
            button.onclick = function() {
                enableRowEditing(row);
            };
            
            console.log('Updated row data:', updatedData);
            alert('Changes saved locally. In a real application, this would update the database.');
        }

        // Initialize application
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
